---
title: "Commonality analysis for Polygenic Scores, mental health, social demographic lifestyle developmental and sets of brain imaging features"
author: "Yue Wang and Narun P"
date:  "`r format(Sys.time(), '%d %b, %Y')`"
output: 
  html_document:
    toc: true
    toc_float: true
    theme: united
    number_sections: true
    toc_depth: 3
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r load_data, echo=FALSE}
rm(list = ls(all.names = TRUE)) #will clear all objects includes hidden objects.
gc() #free up memory and report the memory usage.
```

## Note
Here we the ABCD release 5.1 data-set


This file has all the linear mixed models with Polygenic Scores predictions as a variable. The reasons in doing this is that the number of observations in the Polygenic Scores data is substantially less than all the other variables. To be more specific: we have around 5,000 observations in Polygenic Scores data and 11,000 observations in mental health, social demographic lifestyle developmental and sets of brain imaging features.

# Setting up the environments

## Loading libraries
The following libraries and default settings were used during the analysis:


```{r load_libraries}
options(scipen = 999)
#library("sva")
library(tidyverse)
library("tidymodels")
##parallel map
library(partR2)
library(lme4)
library(yhat)
library(ggtext)
library(ggpubr)
library(cowplot)
library(partR2)
library(lme4)
library(yhat)
library("VennDiagram")
## library to tidy up the linear mixed models
library(sjPlot)

theme_set(theme_bw() + theme(panel.grid = element_blank()))
## parallel processing number of cores register
all_cores <- parallel::detectCores(logical = FALSE) - 5

doParallel::registerDoParallel(cores = all_cores)

```

## Setting up the path

We first loaded all of the relevant data files (not shown here as they refer to local directories):

```{r loading_data, echo=FALSE}
# from Qnap data windows
#datafolder = "//np-qnapa/Data/ABCD/ABCD4/ABCD4SQL/"
#scriptfold = "//np-qnapa/Data/Yue script/"
#NDAfold = "//np-qnapa/Data/ABCD/ABCD4/ABCDStudyNDA/"
#utilFold = "//np-qnapa/Data/ABCD/ABCD3/Analysis/utilFunc/"
#studyNDAFold = "//np-qnapa/Data/ABCD/ABCD4/ABCDStudyNDA/"
#outputfolder = "//np-qnapa/Data/ABCD/ABCD4/ABCD4_precessed_data/"

### unbuntu directories

#datafolder = "/media/Data/ABCD/ABCD4/ABCD4SQL/"
#scriptfold = "/media/Data/Yue script/"
#NDAfold = "/media/Data/ABCD/ABCD4/ABCDStudyNDA/"
#utilFold = "/media/Data/ABCD/ABCD3/Analysis/utilFunc/"
#studyNDAFold = "/media/Data/ABCD/ABCD4/ABCDStudyNDA/"
#outputfolder = "/media/Data/ABCD/ABCD4/ABCD4_precessed_data/"
#featurefolder = "/media/Data/ABCD/ABCD4/Analysis/ManipulatedData/"

### mac directories
datafolder = "/Volumes/Data/ABCD/ABCD4/ABCD4SQL/"
scriptfold = "/Volumes/Data/Yue script/"
NDAfold = "/Volumes/Data/ABCD/ABCD4/ABCDStudyNDA/"
utilFold = "/Volumes/Data/ABCD/ABCD3/Analysis/utilFunc/"
studyNDAFold = "/Volumes/Data/ABCD/ABCD4/ABCDStudyNDA/"
outputfolder = "/Volumes/Data/ABCD/ABCD4/ABCD4_precessed_data/"
featurefolder = "/Volumes/Data/ABCD/ABCD4/Analysis/ManipulatedData/"

```


```{r, cache=FALSE, include=FALSE}
### ubuntu and windows directories
#ABCD3Fold <- '/Volumes/wd/ABCD3/'
#ABCD3Fold <-"~/OneDrive - University of Otago/ABCD3/"
#ABCD4Fold <-"/media/Data/ABCD/ABCD4/"
#ABCD3Fold <-"/media/Data/ABCD/ABCD3/"
#scriptfold = "/media/Data/Yue script/"

# mac directories
ABCD4Fold <-"/Volumes/Data/ABCD/ABCD4/"
ABCD3Fold <-"/Volumes/Data/ABCD/ABCD3/"
scriptfold = "/Volumes/Data/Yue script/"

#ABCD4Fold <- "//np-qnapa/Data/ABCD/ABCD4/"
#setwd(paste0(ABCD3Fold, "Analysis/CognitionP"))
dataFold <- paste0(ABCD4Fold, "ABCD4SQL/")
utilFold <- paste0(ABCD3Fold, "Analysis/utilFunc/")

nesi_folder <- "/Volumes/sci-psy-narun/Nesi/Yue/"
datafolder_5.1 = '/Volumes/sci-psy-narun/abcd-data-release-5.1/core/'
outputfolder_5.1 = "/Volumes/sci-psy-narun/Yue/ABCD_5.1_data_precessing/processed_data/"
dicfolder_5.1 = '/Volumes/sci-psy-narun/abcd-data-release-5.1/dictionary/'
featurefolder = "/Volumes/sci-psy-narun/Yue/ABCD_5.1_data_precessing/processed_data/"
utilFold = "/Volumes/Data/ABCD/ABCD3/Analysis/utilFunc/"
imagingfolder_5.1  = paste0(datafolder_5.1, "imaging/")


gene_fold <- paste0(ABCD4Fold, "RicPGS/RicFIles20_Feb_2022/abcd-release-3.0_chrall_0.8-mac5-hg19-eur-qc-v9/")

```

```{r}
source(paste0(scriptfold,"stacking_gfactor_modelling/r_functions_5.1.R"))

```

# Data Preparation

## load fitted gfactors from brain imaging and psychopathology

### load brain scan fitted results from stacking models

```{r}
rf_baseline <- readRDS(paste0(nesi_folder,"stacking_gfactor_modelling/collect_random_forest_results/random_forest_baseline_results.RDS"))

rf_followup <- readRDS(paste0(nesi_folder,"stacking_gfactor_modelling/collect_random_forest_results/random_forest_followup_results.RDS"))
```




### load the mental health predicted results

```{r}
psy_pred <- readRDS(paste0(scriptfold,"Common_psy_gene_brain_all/saved_outputs/psychopathology_pls_pred_no_asr_5.1.RData"))

```


### load the social demographic lifestyle developmental predicted results


```{r}
ses_pred <- readRDS(paste0(scriptfold,'genetics_psychopathology_common_scan_all_scripts/ses_pls_pred_5.1', '.RData'))

```

### Load in genetics related to cognition predicted results 


```{r}

genetics_cog <- readRDS(paste0(scriptfold,'genetics_psychopathology_common_scan_all_scripts/psychopathology_cog_gene_pred_residual_5.1', '.RData'))
```

### load the computed gfactor

```{r}

gfactor_list <- readRDS(paste0(scriptfold,'genetics_psychopathology_common_scan_all_scripts/gfactor_scale_seperate_5.1', '.RData'))


```


## process loaded brain imaging, Polygenic Scores, mental health and social demographic lifestyle developmental model predictions

Be careful with what site you choose.

```{r}

rf_baseline_pred <- map(rf_baseline,"test_pred")
rf_baseline_pred_tibble <- map(rf_baseline_pred,"model_predict")
rf_baseline_table <- map(rf_baseline,"test_data")

rf_followup_pred <- map(rf_followup,"test_pred")
rf_followup_pred_tibble <- map(rf_followup_pred,"model_predict")
rf_followup_table <- map(rf_followup,"test_data")

```


```{r}

gfactor_baselie_test <- map(gfactor_list,"output_test_baseline")
gfactor_followup_test <- map(gfactor_list,"output_test_followup")


```

```{r}
subj_info <- c("SRC_SUBJECT_ID","SITE_ID_L","EVENTNAME")

```

Functions to process the loaded prediction results.

```{r}
pred_processing <- function(baseline_pred, followup_pred, baseline_table, followup_table,pred_name){
  names_vec <- c(subj_info,pred_name)
  
  baseline_subj_info <- baseline_table %>% select(all_of(subj_info))
  baseline_pred_vec <- baseline_pred %>% select(model_predict)
  baseline_output <- bind_cols(baseline_subj_info,baseline_pred_vec)
  names(baseline_output) <- names_vec
  
  followup_subj_info <- followup_table %>% select(all_of(subj_info))
  followup_pred_vec <- followup_pred %>% select(model_predict)
  followup_output <- bind_cols(followup_subj_info,followup_pred_vec)
  names(followup_output) <- names_vec

  output_all <- bind_rows(baseline_output,followup_output)
  return(list(baseline_output = baseline_output,
              followup_output = followup_output))
}




```

Combine all the subject information and prediction together and change the names.


```{r}
processed_rf_results <- pmap(list(rf_baseline_pred_tibble,rf_baseline_table,
                                  rf_followup_pred_tibble,rf_followup_table),
                             ~pred_processing(baseline_pred=..1,
                                              followup_pred=..3, 
                                              baseline_table=..2, 
                                              followup_table=..4,
                                              pred_name="random_forest_stacking"))


processed_psy_results <- pmap(list(psy_pred[["baseline_test_pred"]],
                                   psy_pred[["baseline_test_data"]],
                                  psy_pred[["followup_test_pred"]],
                                  psy_pred[["followup_test_data"]]),
                             ~pred_processing(baseline_pred=..1,
                                              followup_pred=..3, 
                                              baseline_table=..2, 
                                              followup_table=..4,
                                              pred_name="psychopathology_pls"))


processed_ses_results <- pmap(list(ses_pred[["baseline_test_pred"]],
                                   ses_pred[["baseline_test_data"]],
                                  ses_pred[["followup_test_pred"]],
                                  ses_pred[["followup_test_data"]]),
                             ~pred_processing(baseline_pred=..1,
                                              followup_pred=..3, 
                                              baseline_table=..2, 
                                              followup_table=..4,
                                              pred_name="ses_pls"))
```


```{r}

site_char <- names(processed_psy_results)

```

### prepocessing genetics prediction results

load in family index data


```{r, cache = FALSE, warning=FALSE}
acspsw03 <- read.csv("/Volumes/sci-psy-narun/abcd-data-release-5.1/core/abcd-general/abcd_y_lt.csv", na = c("", "NA", "999", "777"))
names(acspsw03) <-toupper(colnames(acspsw03))
acspsw03_select <- acspsw03 %>% filter(EVENTNAME %in% c("baseline_year_1_arm_1","2_year_follow_up_y_arm_1" ))

### write NAs of the followup family ids to be the family IDs at baseline
acspsw03_baseline <- acspsw03_select %>% filter(EVENTNAME == "baseline_year_1_arm_1" )
acspsw03_followup <- acspsw03_select %>% filter(EVENTNAME == "2_year_follow_up_y_arm_1" )

fam_basline <- acspsw03_baseline %>% dplyr::select(all_of(c("REL_FAMILY_ID","SRC_SUBJECT_ID")))

acspsw03_followup <- acspsw03_followup %>%dplyr::select(-"REL_FAMILY_ID") %>% 
                                          left_join(fam_basline, by = "SRC_SUBJECT_ID")

acspsw03_select <- bind_rows(acspsw03_baseline,acspsw03_followup)

demo <- read.csv("/Volumes/sci-psy-narun/abcd-data-release-5.1/core/abcd-general/abcd_p_demo.csv", na = c("", "NA", "999", "777"))
names(demo) <-toupper(colnames(demo))
demo_select <- demo %>% filter(EVENTNAME %in% c("baseline_year_1_arm_1","2_year_follow_up_y_arm_1" ))




ACS <- left_join(demo_select,acspsw03_select,by =c("SRC_SUBJECT_ID","EVENTNAME"))

# guardian-report relationship
# Relationship of the participant in his or her family
# 0 = single; 1 = sibling; 2 = twin; 3 = triplet
# ACS %>% count(REL_RELATIONSHIP)

ACSselected <- ACS %>% 
  dplyr::select("SRC_SUBJECT_ID", "EVENTNAME", "DEMO_SEX_V2", "INTERVIEW_AGE", "RACE_ETHNICITY", 
                              "REL_FAMILY_ID", "ACS_RAKED_PROPENSITY_SCORE","SITE_ID_L") %>%
  mutate(REL_FAMILY_ID = as.factor(REL_FAMILY_ID))

ACSselected_baseline <- ACSselected %>%
                        filter(EVENTNAME =="baseline_year_1_arm_1")%>%
                        select(SRC_SUBJECT_ID,REL_FAMILY_ID)

ACSselected_followup <- ACSselected %>%
                        filter(EVENTNAME =="1_year_follow_up_y_arm_1")%>%
                        select(SRC_SUBJECT_ID,REL_FAMILY_ID)
```


Process the Polygenic Scores data.

```{r}
genetics_cog_baseline_pred <-genetics_cog[["baseline_test_pred"]]
genetics_cog_baseline_table <-genetics_cog[["baseline_test_data"]]

genetics_cog_followup_pred <- genetics_cog[["followup_test_pred"]]
genetics_cog_followup_data <- genetics_cog[["followup_test_data"]]


pred_processing_gene <- function(baseline_pred, followup_pred, baseline_table, followup_table,pred_name){
  names_vec <- c(c("SRC_SUBJECT_ID","SITE_ID_L"),pred_name)
  
  baseline_subj_info <- baseline_table %>% select(all_of(c("SRC_SUBJECT_ID","SITE_ID_L")))
  baseline_pred_vec <- baseline_pred %>% select(model_predict)
  baseline_output <- bind_cols(baseline_subj_info,baseline_pred_vec)
  names(baseline_output) <- names_vec
  
  followup_subj_info <- followup_table %>% select(all_of(c("SRC_SUBJECT_ID","SITE_ID_L")))
  followup_pred_vec <- followup_pred %>% select(model_predict)
  followup_output <- bind_cols(followup_subj_info,followup_pred_vec)
  names(followup_output) <- names_vec

  output_all <- bind_rows(baseline_output,followup_output)
  return(list(baseline_output = baseline_output,
              followup_output = followup_output))
}

processed_gene_results <- pmap(list(genetics_cog_baseline_pred,genetics_cog_baseline_table,
                                  genetics_cog_followup_pred,genetics_cog_followup_data),
                             ~pred_processing_gene(baseline_pred=..1,
                                              followup_pred=..3, 
                                              baseline_table=..2, 
                                              followup_table=..4,
                                              pred_name="gene_cog"))


```

count the total number in the genetics

```{r}

genetics_cog_baseline_tibble <- map(genetics_cog_baseline_table,~dim(.))%>%
  do.call(rbind,.)

sum(genetics_cog_baseline_tibble[,1])

### checking unique IDs

genetics_cog_baseline_ID <- map(genetics_cog_baseline_table,~unique(.[["SRC_SUBJECT_ID"]])%>%length())%>%
                            do.call(rbind,.)
sum(genetics_cog_baseline_ID)

```

Join the brain imaging, Polygenic Scores, mental health and social demographic lifestyle developmental model predictions


```{r}

join_data_all <- function(site_input){
  ### join the data and drop NA
  rf_baseline_tibble <- processed_rf_results[[site_input]][["baseline_output"]]
  rf_followup_tibble <- processed_rf_results[[site_input]][["followup_output"]]
  psy_baseline_tibble <- processed_psy_results[[site_input]][["baseline_output"]]
  psy_followup_tibble <- processed_psy_results[[site_input]][["followup_output"]]
  ses_baseline_tibble <- processed_ses_results[[site_input]][["baseline_output"]]
  ses_followup_tibble <- processed_ses_results[[site_input]][["followup_output"]]
  

  baseline_rf_psy_ses <- plyr::join_all(list(rf_baseline_tibble,
                                      psy_baseline_tibble,
                                      ses_baseline_tibble), 
                                 by =subj_info, type = 'full')
  followup_rf_psy_ses <- plyr::join_all(list(rf_followup_tibble,
                                      psy_followup_tibble,
                                      ses_followup_tibble), 
                                 by =subj_info, type = 'full')
  


   gene_baseline_tibble <-processed_gene_results[[site_input]][["baseline_output"]]
  gene_followup_tibble <- processed_gene_results[[site_input]][["followup_output"]]
  
  
   baseline_rf_psy_ses_gene <- full_join(baseline_rf_psy_ses,
                                      gene_baseline_tibble, 
                                 by =c("SRC_SUBJECT_ID","SITE_ID_L" ))
  followup_rf_psy_ses_gene <- full_join(followup_rf_psy_ses,
                                      gene_followup_tibble, 
                                 by =c("SRC_SUBJECT_ID","SITE_ID_L" ))
  

  gfactor_baseline <- gfactor_baselie_test[[site_input]]
  gfactor_followup <- gfactor_followup_test[[site_input]]
  
  baseline_all <- plyr::join_all(list(baseline_rf_psy_ses_gene,
                                      ACSselected_baseline,gfactor_baseline), 
                                 by ="SRC_SUBJECT_ID", type = 'full')%>%
                                 drop_na()
  followup_all <- plyr::join_all(list(followup_rf_psy_ses_gene,
                                      ACSselected_baseline,gfactor_followup), 
                                 by ="SRC_SUBJECT_ID", type = 'full')%>%
                                 drop_na()

 output_all <- bind_rows(baseline_all,followup_all)
  
  return(list(baseline = baseline_all,
              followup=followup_all,
              all = output_all))
  
}


```


```{r}

gfactor_all <- map(.x = site_char,~join_data_all(site_input = .x))

names(gfactor_all) <- site_char

gfactor_all_baseline <- map(gfactor_all,"baseline")
gfactor_all_followup <- map(gfactor_all,"followup")
gfactor_all_baseline_followup <- map(gfactor_all,"all")

```

### get the residual of of the predicted values with age, sex and med information


ATC/DDD Index 2024

ATC code

A ALIMENTARY TRACT AND METABOLISM
B BLOOD AND BLOOD FORMING ORGANS
C CARDIOVASCULAR SYSTEM
D DERMATOLOGICALS
G GENITO URINARY SYSTEM AND SEX HORMONES
H SYSTEMIC HORMONAL PREPARATIONS, EXCL. SEX HORMONES AND INSULINS
J ANTIINFECTIVES FOR SYSTEMIC USE
L ANTINEOPLASTIC AND IMMUNOMODULATING AGENTS
M MUSCULO-SKELETAL SYSTEM
N NERVOUS SYSTEM
P ANTIPARASITIC PRODUCTS, INSECTICIDES AND REPELLENTS
R RESPIRATORY SYSTEM
S SENSORY ORGANS
V VARIOUS

```{r}
abcd_med_5.1 <-  readRDS(paste0(scriptfold,'Common_psy_gene_brain_all/saved_outputs/performance_metrics/med_info_all_5.1', '.RData'))                  

 reg_resp <- c("random_forest_stacking","psychopathology_pls","ses_pls","gene_cog") %>% set_names()
 subj_info_vec <- c(subj_info,"INTERVIEW_AGE")
 med_regress_features <- c("is_ATC_A","is_ATC_B","is_ATC_C","is_ATC_D","is_ATC_G","is_ATC_H","is_ATC_J","is_ATC_L",
                           "is_ATC_M","is_ATC_N","is_ATC_P","is_ATC_R","is_ATC_S","is_ATC_V","DEMO_SEX_V2","INTERVIEW_AGE")
 ### follow up sex information are all NAs (biological sense of sex)
 sex_info_table <- ACSselected %>% filter(EVENTNAME =="baseline_year_1_arm_1") %>% select(all_of(subj_info),"DEMO_SEX_V2") %>% 
                   select(-EVENTNAME)
site_char <- site_char %>% set_names()


 residual_one_resp <- function(resp_input= "random_forest_stacking", 
                               data_input=data_med){
   formula_input <- paste0(resp_input," ~ ",paste0(med_regress_features, collapse = " + "))
   residual_output <- residuals(lm(as.formula(formula_input),data = data_input))
   return(residual_output)
 }
 
get_residuals_med_sex_age <- function(data_list = gfactor_all_followup,
                                      event_input =  "2_year_follow_up_y_arm_1"){
  data_input <- data_list %>% do.call(bind_rows,.)
 
  
  age_info <- ACSselected %>% 
              filter(EVENTNAME == event_input) %>%
              select(all_of(subj_info_vec))
  
  data_fam <- plyr::join_all(list(data_input,age_info),type = "left", by = subj_info) %>% drop_na()
  data_all <- left_join(data_fam, sex_info_table, by = c( "SRC_SUBJECT_ID","SITE_ID_L"))
  ### remove columns that are all 0s
  data_med <- left_join(data_all, abcd_med_5.1, by = c( "SRC_SUBJECT_ID","EVENTNAME")) %>% drop_na()
  
  data_med_info <- data_med %>% select(starts_with("is_ATC_"))%>% select_if(colSums(.) != 0)
  
  data_med_processed <- data_med %>% select(-starts_with("is_ATC_")) %>% bind_cols(data_med_info) %>%
  mutate(across(starts_with("is_ATC_"),factor))
  ### get all the residuals
  
  residual_list <- reg_resp %>% map(.,~residual_one_resp(resp_input = ., data_input=data_med))
  data_output <- tibble(random_forest_stacking = residual_list[["random_forest_stacking"]]%>% as.numeric(),
                        psychopathology_pls= residual_list[["psychopathology_pls"]] %>% as.numeric(),
                        ses_pls = residual_list[["ses_pls"]]%>% as.numeric(),
                        gene_cog = residual_list[["gene_cog"]]%>% as.numeric())
data_input_select <- data_med %>% select(all_of(c("SRC_SUBJECT_ID","SITE_ID_L","EVENTNAME","REL_FAMILY_ID","gfactor"))) 
 output_table  <-  bind_cols(data_input_select,data_output) 

output_list <- map(site_char,~filter(output_table,SITE_ID_L == .))
return(output_list)
}

```

Compute the residuals


```{r}

gfactor_all_baseline_residual <-  get_residuals_med_sex_age(data_list = gfactor_all_baseline,
                                      event_input =  "baseline_year_1_arm_1")

gfactor_all_followup_residual <-  get_residuals_med_sex_age(data_list = gfactor_all_followup,
                                      event_input =  "2_year_follow_up_y_arm_1")
```

## Mean centering within family and within site


This script only perform the commonality analyses for the models with genetics. In genetics there are only around 5000 participants, which is much smaller than all the other models. 

Some explanation of the variables:

brain_savg: the average of brain prediction results within each site.

brain_cws: brain predictions centered within each site.

mental_savg: the average of mental health predictions results within each site.

mental_cws: mental health predictions centered within each site.

sdl_savg: the average of social demographic lifestyle predictions results within each site.

sdl_cws: social demographic lifestyle predictions centered within each site.

gene_favg: the average of gene predictions results within each family.

gene_cwf: gene predictions centered within each family (basically zeros as the data is comprised of single child in those families).

 gene_savg_favg: averaged gene_favg estimates across each site

 gene_cws_cwf: gene_favg estimates centered within each site.
 
 
 
```{r}

center_by_family_site <- function(data_input){
  
 data_input <- data_input[order(data_input$REL_FAMILY_ID),]
 count_by_family <- data_input %>% count(REL_FAMILY_ID)

 
 mean_by_family_gene <- data_input %>% group_by(REL_FAMILY_ID)%>%
                                 summarise_at(vars(gene_cog),mean)
 
 mean_vec_gene <- rep(mean_by_family_gene$gene_cog,times = count_by_family$n)
 
 data_gene  <- data_input%>%
                 mutate(gene_favg = mean_vec_gene,
                        gene_cwf = gene_cog - gene_favg)
 
 
 output_data <- data_gene %>% 
    mutate(brain_savg = mean(random_forest_stacking))%>% 
    mutate(brain_cws = random_forest_stacking-brain_savg)%>% 
   mutate(mental_savg = mean(psychopathology_pls))%>%
    mutate(mental_cws = psychopathology_pls - mental_savg)%>% 
    mutate(gene_savg_favg = mean(gene_favg))%>%
    mutate(gene_cws_cwf = gene_cwf - gene_savg_favg)%>% 
   mutate(sdl_savg = mean(ses_pls))%>%
    mutate(sdl_cws = ses_pls - sdl_savg)

return(output_data)
  }


centered_all_baseline <- map(gfactor_all_baseline_residual,~center_by_family_site(data_input = .))
centered_all_followup <- map(gfactor_all_followup_residual,~center_by_family_site(data_input = .))

```

## Scale the overall data by each variable

```{r}
gfactor_all_pred_centered_site_baseline <- centered_all_baseline%>%
                                           do.call(rbind,.)
gfactor_all_pred_centered_site_followup <- centered_all_followup%>%
                                           do.call(rbind,.)


features_not_scale <- c(subj_info, "REL_FAMILY_ID","gfactor")

features_scale <- gfactor_all_pred_centered_site_baseline %>% select(-all_of(features_not_scale))%>% colnames()
## recipe to scale the features
recipe_scale <- function(train_input=gfactor_all_pred_centered_site_baseline){
  norm_recipe <- recipe( as.formula("gfactor~."), data = train_input) %>%
    update_role(all_of(features_scale), new_role = "predictor")%>%
    update_role("gfactor", new_role = "outcome" )%>%
    # normalize numeric predictors and outcome
    step_normalize(all_numeric_predictors())
  return(norm_recipe)
}


all_baseline_recipe <- 

data_all_baseline <-recipe_scale(train_input=gfactor_all_pred_centered_site_baseline) %>%
                    prep() %>%
                    juice()


data_all_followup <-recipe_scale(train_input=gfactor_all_pred_centered_site_followup) %>%
                    prep() %>%
                    juice()



```

```{r,eval=FALSE}

saveRDS(data_all_baseline,paste0(scriptfold,"Common_psy_gene_brain_all/saved_outputs/common_all_baseline_5.1.RData"))

saveRDS(data_all_followup,paste0(scriptfold,"Common_psy_gene_brain_all/saved_outputs/common_all_followup_5.1.RData"))



```

# commonality analysis between stacked brain scan, psychopathology and genetics that predicts cognition


Commonality analysis with the linear mixed models

Commonality between three features within a 4 level nested structure

Measurements are nested within subjects

Subjects are nested within families

Families are nested within sites

Due to the age requirements of all the subjects. Participants within the family are likely to be twins.

Because the data structure (number of subjects) and the modelling methods (through grid search) are so different between baseline and followup. The analysis is done separately between them.


Note: this model is not included in the finally manuscript.

## Function to compute the commonality coefficients

```{r}
common_analysis_gene_psy_brain_multi_both <- function(data_input=gfactor_all_pred_centered_site_all){
print("full_model")  
  full_model <- lmer(gfactor ~ brain_savg+ brain_cws+ mental_savg+mental_cws+gene_savg_favg+gene_cws_cwf+ (1|SITE_ID_L:REL_FAMILY_ID),data = data_input)
# runs very slow with this multilevel model
 # rsq_full_model <- MuMIn::r.squaredGLMM(full_model)
rsq_full_model <- performance::r2(full_model)
  
    print("brain_psy_model") 
  brain_psy_model <- lmer(gfactor ~ brain_savg+ brain_cws+ mental_cws+mental_savg+ (1|SITE_ID_L:REL_FAMILY_ID),data = data_input)
  rsq_brain_psy <- performance::r2(brain_psy_model)
 

  print("gene_psy_model")
  ## this model has singularity problem
  gene_psy_model <- lmer(gfactor ~mental_cws+mental_savg+gene_savg_favg+gene_cws_cwf+ (1|SITE_ID_L:REL_FAMILY_ID),data = data_input)
  rsq_gene_psy <- performance::r2(gene_psy_model)


   print("brain_gene_model") 
  brain_gene_model <- lmer(gfactor ~ brain_savg+ brain_cws+gene_savg_favg+gene_cws_cwf+ (1|SITE_ID_L:REL_FAMILY_ID),data = data_input)
  rsq_brain_gene <- performance::r2(brain_gene_model)


  print("brain_model")
  brain_model <- lmer(gfactor ~ brain_savg+ brain_cws+ (1|SITE_ID_L:REL_FAMILY_ID),data = data_input)
  rsq_brain <- performance::r2(brain_model)


  print("psy_model")
  psy_model <- lmer(gfactor ~  mental_cws+mental_savg+ (1|SITE_ID_L:REL_FAMILY_ID),data = data_input)
  rsq_psy <- performance::r2(psy_model)


    print("gene_model")
  gene_model <- lmer(gfactor ~ gene_savg_favg+gene_cws_cwf+ (1|SITE_ID_L:REL_FAMILY_ID),data = data_input)
  rsp_gene <- performance::r2(gene_model)

  
  unique_gene_margin <- rsq_full_model$R2_marginal-rsq_brain_psy$R2_marginal
    
  unique_brain_margin <- rsq_full_model$R2_marginal-rsq_gene_psy$R2_marginal
  
  unique_psy_margin <- rsq_full_model$R2_marginal-rsq_brain_gene$R2_marginal
    
  common_brain_psy_margin <- rsq_brain_gene$R2_marginal+rsq_gene_psy$R2_marginal-rsp_gene$R2_marginal-rsq_full_model$R2_marginal
  
  common_gene_psy_margin <- rsq_brain_gene$R2_marginal+rsq_brain_psy$R2_marginal-rsq_brain$R2_marginal-rsq_full_model$R2_marginal
  
  common_brain_gene_margin <- rsq_brain_psy$R2_marginal+rsq_gene_psy$R2_marginal-rsq_psy$R2_marginal-rsq_full_model$R2_marginal
  
  common_brain_gene_psy_margin <-rsp_gene$R2_marginal+rsq_brain$R2_marginal+rsq_psy$R2_marginal-rsq_brain_gene$R2_marginal-rsq_gene_psy$R2_marginal-rsq_brain_psy$R2_marginal+rsq_full_model$R2_marginal
  
  
  
  unique_gene_conditional <- rsq_full_model$R2_conditional-rsq_brain_psy$R2_conditional
    
  unique_brain_conditional <- rsq_full_model$R2_conditional-rsq_gene_psy$R2_conditional
  
  unique_psy_conditional <- rsq_full_model$R2_conditional-rsq_brain_gene$R2_conditional
    
  common_brain_psy_conditional <- rsq_brain_gene$R2_conditional+rsq_gene_psy$R2_conditional-rsp_gene$R2_conditional-rsq_full_model$R2_conditional
  
  common_gene_psy_conditional <- rsq_brain_gene$R2_conditional+rsq_brain_psy$R2_conditional-rsq_brain$R2_conditional-rsq_full_model$R2_conditional
  
  common_brain_gene_conditional <- rsq_brain_psy$R2_conditional+rsq_gene_psy$R2_conditional-rsq_psy$R2_conditional-rsq_full_model$R2_conditional
  
  common_brain_gene_psy_conditional <-rsp_gene$R2_conditional+rsq_brain$R2_conditional+rsq_psy$R2_conditional-rsq_brain_gene$R2_conditional-rsq_gene_psy$R2_conditional-rsq_brain_psy$R2_conditional+rsq_full_model$R2_conditional
  
  
  output_common_tibble <- tibble(variable_effects = c("unique_gene",
                                               "unique_brain",
                                              "unique_psy",
                                              "common_brain_psy",
                                              "common_gene_psy",
                                              "common_brain_gene",
                                              "common_brain_gene_psy"),
                          marginal_rsq = c(unique_gene_margin,
                                              unique_brain_margin,
                                              unique_psy_margin,
                                              common_brain_psy_margin,
                                              common_gene_psy_margin,
                                              common_brain_gene_margin,
                                              common_brain_gene_psy_margin),
                          conditional_rsq = c(unique_gene_conditional,
                                              unique_brain_conditional,
                                              unique_psy_conditional,
                                              common_brain_psy_conditional,
                                              common_gene_psy_conditional,
                                              common_brain_gene_conditional,
                                              common_brain_gene_psy_conditional))
  output_rsq_tibble <- tibble(model_names<- c("gene",
                                               "brain",
                                              "psy",
                                              "brain_psy",
                                              "gene_psy",
                                              "brain_gene",
                                              "brain_gene_psy"),
                          marginal_rsq = c(rsp_gene$R2_marginal,
                                              rsq_brain$R2_marginal,
                                              rsq_psy$R2_marginal,
                                              rsq_brain_psy$R2_marginal,
                                              rsq_gene_psy$R2_marginal,
                                              rsq_brain_gene$R2_marginal,
                                              rsq_full_model$R2_marginal),
                          conditional_rsq = c(rsp_gene$R2_conditional,
                                              rsq_brain$R2_conditional,
                                              rsq_psy$R2_conditional,
                                              rsq_brain_psy$R2_conditional,
                                              rsq_gene_psy$R2_conditional,
                                              rsq_brain_gene$R2_conditional,
                                              rsq_full_model$R2_conditional))
  
  return(list(output_common_tibble=output_common_tibble,
              output_rsq_tibble=output_rsq_tibble,
              full_model=full_model,
              brain_psy_model=brain_psy_model,
              gene_psy_model=gene_psy_model,
              brain_gene_model=brain_gene_model,
             brain_model=brain_model,
             psy_model=psy_model,
             gene_model=gene_model
             ))
  }


```


## Process the table results 


```{r}
common_analysis_gene_psy_brain_all_site_both <-common_analysis_gene_psy_brain_multi_both(data_input=data_all_baseline)




common_analysis_gene_psy_brain_all_site_both_followup <-common_analysis_gene_psy_brain_multi_both(data_input=data_all_followup)



```


```{r}
baseline_plot_vec <- common_analysis_gene_psy_brain_all_site_both[[1]]$marginal_rsq
#baseline_plot_vec_corrected <- baseline_plot_vec-baseline_plot_vec[5]/6 
#### get rid of the negative values
#baseline_plot_vec_corrected[5] <- 0


baseline_plot_vec_percent <- baseline_plot_vec/sum(baseline_plot_vec)*100 
baseline_plot_vec_percent <- round(baseline_plot_vec_percent,2)
print(baseline_plot_vec_percent)

baseline_plot_vec_raw <- baseline_plot_vec*100 
baseline_plot_vec_raw <- round(baseline_plot_vec_raw,2)
print(baseline_plot_vec_raw)


followup_plot_vec <- common_analysis_gene_psy_brain_all_site_both_followup[[1]]$marginal_rsq
#baseline_plot_vec_corrected_followup <- baseline_plot_vec_followup-baseline_plot_vec_followup[5]/6
#### get rid of the negative values
#baseline_plot_vec_corrected_followup[5] <- 0


followup_plot_vec_percentage <- followup_plot_vec/sum(followup_plot_vec)*100
followup_plot_vec_percentage <- round(followup_plot_vec_percentage,2)
print(followup_plot_vec_percentage)

followup_plot_vec_raw <- followup_plot_vec*100 
followup_plot_vec_raw <- round(followup_plot_vec_raw,2)
print(followup_plot_vec_raw)

baseline_gene_psy_brain_table <- common_analysis_gene_psy_brain_all_site_both[[1]]%>%
                                 mutate(corrected_percent = baseline_plot_vec_percent)%>%
                                 mutate(corrected_raw = baseline_plot_vec_raw)




baseline_gene_psy_brain_table%>% 
    kableExtra::kbl(caption = "Commonality analysis in baseline") %>%
    kableExtra::kable_classic(full_width = F, 
                             html_font = "Cambria")
common_analysis_gene_psy_brain_all_site_both[[2]]%>% 
    kableExtra::kbl(caption = "R^2 metrics for all models in baseline") %>%
    kableExtra::kable_classic(full_width = F, 
                             html_font = "Cambria")



followup_gene_psy_brain_table <- common_analysis_gene_psy_brain_all_site_both_followup[[1]]%>%
                                 mutate(corrected_percent = followup_plot_vec)%>%
                                 mutate(corrected_raw = followup_plot_vec_raw)


followup_gene_psy_brain_table%>% 
    kableExtra::kbl(caption = "Commonality analysis in followup") %>%
    kableExtra::kable_classic(full_width = F, 
                             html_font = "Cambria")
common_analysis_gene_psy_brain_all_site_both_followup[[2]]%>% 
    kableExtra::kbl(caption = "R^2 metrics for all models in followup") %>%
    kableExtra::kable_classic(full_width = F, 
                             html_font = "Cambria")
```
## Plot the venn diagram

 baseline percentage of rsquare plot

```{r}
overrideTriple=TRUE

venn_plot_baseline_percent <- draw.triple.venn(area1 = baseline_plot_vec_percent[2]+baseline_plot_vec_percent[6]+baseline_plot_vec_percent[4]+baseline_plot_vec_percent[7],
  area2 = baseline_plot_vec_percent[3]+baseline_plot_vec_percent[4]+baseline_plot_vec_percent[5]+baseline_plot_vec_percent[7],
  area3 = baseline_plot_vec_percent[1]+baseline_plot_vec_percent[5]+baseline_plot_vec_percent[6]+baseline_plot_vec_percent[7],
  n12 = baseline_plot_vec_percent[4]+baseline_plot_vec_percent[7],
  n13 = baseline_plot_vec_percent[6]+baseline_plot_vec_percent[7],
  n23 = baseline_plot_vec_percent[5]+baseline_plot_vec_percent[7],
  n123 = baseline_plot_vec_percent[7],
  category = c("Brain Imaging", "Mental Health", "Polygenic Scores"),
  fill = c("#009E73", "#D55E00", "#CC79A7"),
  lty = "dashed",
  cat.col = c("#009E73", "#D55E00", "#CC79A7"),
  filename = NULL,
  cex = 0.001, ## label font size
  cat.cex = 2,### caption font size
  lwd = 2,
  cat.fontface = "bold",
  cat.dist = c(0.1, 0.1,-0.2), # Modified
  cat.pos = c(5,10,10),# Modified
  print.mode="percent",
  euler.d=F,
  scaled=F,
  reverse = F)

grid.newpage()

#grid::grid.draw(venn_plot_baseline_percent)
#invisible(dev.off())
```

Without any labels

```{r}
overrideTriple=TRUE

venn_plot_baseline_percent <- draw.triple.venn(area1 = baseline_plot_vec_percent[2]+baseline_plot_vec_percent[6]+baseline_plot_vec_percent[4]+baseline_plot_vec_percent[7],
  area2 = baseline_plot_vec_percent[3]+baseline_plot_vec_percent[4]+baseline_plot_vec_percent[5]+baseline_plot_vec_percent[7],
  area3 = baseline_plot_vec_percent[1]+baseline_plot_vec_percent[5]+baseline_plot_vec_percent[6]+baseline_plot_vec_percent[7],
  n12 = baseline_plot_vec_percent[4]+baseline_plot_vec_percent[7],
  n13 = baseline_plot_vec_percent[6]+baseline_plot_vec_percent[7],
  n23 = baseline_plot_vec_percent[5]+baseline_plot_vec_percent[7],
  n123 = baseline_plot_vec_percent[7],
#  category = c("Brain Imaging", "Mental Health", "Polygenic Scores"),
  fill = c("#009E73", "#D55E00", "#CC79A7"),
  lty = "dashed",
  cat.col = c("#009E73", "#D55E00", "#CC79A7"),
  filename = NULL,
  cex = 0.001, ## label font size
  cat.cex = 2,### caption font size
  lwd = 2,
  cat.fontface = "bold",
  cat.dist = c(0.1, 0.1,-0.1), # Modified
  cat.pos = c(5,10,-10),# Modified
  print.mode="percent",
  euler.d=F,
  scaled=F,
  reverse = F)

grid.newpage()

#grid::grid.draw(venn_plot_baseline_percent)
#invisible(dev.off())
```




```{r}
#overrideTriple=TRUE

venn_plot_baseline_percent <- draw.triple.venn(area1 = baseline_plot_vec_percent[2]+baseline_plot_vec_percent[6]+baseline_plot_vec_percent[4]+baseline_plot_vec_percent[7],
  area2 = baseline_plot_vec_percent[3]+baseline_plot_vec_percent[4]+baseline_plot_vec_percent[5]+baseline_plot_vec_percent[7],
  area3 = baseline_plot_vec_percent[1]+baseline_plot_vec_percent[5]+baseline_plot_vec_percent[6]+baseline_plot_vec_percent[7],
  n12 = baseline_plot_vec_percent[4]+baseline_plot_vec_percent[7],
  n13 = baseline_plot_vec_percent[6]+baseline_plot_vec_percent[7],
  n23 = baseline_plot_vec_percent[5]+baseline_plot_vec_percent[7],
  n123 = baseline_plot_vec_percent[7],
  category = c("Brain Imaging", "Mental Health", "Polygenic Scores"),
  fill = c("#009E73", "#D55E00", "#CC79A7"),
  lty = "dashed",
  cat.col = c("black", "black", "black"),
    filename = NULL,
  cex = 2, ## label font size
  cat.cex = 2,### caption font size
  lwd = 2,
  cat.fontface = "bold",
  cat.dist = c(-0.1, -0.1,-0.1), # Modified
  #cat.pos = c(-30, 150,100),# Modified
  print.mode="percent"
  )


grid.newpage()

#grid::grid.draw(venn_plot_baseline_percent)
#invisible(dev.off())
```
### baseline rsquare score plot

```{r}
venn_plot_baseline_raw <- draw.triple.venn(area1 = baseline_plot_vec_raw[2]+baseline_plot_vec_raw[6]+baseline_plot_vec_raw[4]+baseline_plot_vec_raw[7],
  area2 = baseline_plot_vec_raw[3]+baseline_plot_vec_raw[4]+baseline_plot_vec_raw[5]+baseline_plot_vec_raw[7],
  area3 = baseline_plot_vec_raw[1]+baseline_plot_vec_raw[5]+baseline_plot_vec_raw[6]+baseline_plot_vec_raw[7],
  n12 = baseline_plot_vec_raw[4]+baseline_plot_vec_raw[7],
  n13 = baseline_plot_vec_raw[6]+baseline_plot_vec_raw[7],
  n23 = baseline_plot_vec_raw[5]+baseline_plot_vec_raw[7],
  n123 = baseline_plot_vec_raw[7],
  category = c("Brain Imaging", "Mental Health", "Polygenic Scores"),
  fill = c("#009E73", "#D55E00", "#CC79A7"),
  lty = "dashed",
  cat.col = c("black", "black", "black"),
  filename = NULL,
  cex = 2, ## label font size
  cat.cex = 2,### caption font size
  lwd = 2,
  cat.fontface = "bold",
  cat.dist = c(-0.1, -0.1,-0.1), # Modified
  #cat.pos = c(-30, 150,100),# Modified
  #print.mode="percent"
  )

grid.newpage()

#grid::grid.draw(venn_plot_baseline_raw)
#invisible(dev.off())
```

## venn diagram for followup


```{r}
venn_plot_followup_percent <- draw.triple.venn(area1 = followup_plot_vec_percentage[2]+followup_plot_vec_percentage[6]+followup_plot_vec_percentage[4]+followup_plot_vec_percentage[7],
  area2 = followup_plot_vec_percentage[3]+followup_plot_vec_percentage[4]+followup_plot_vec_percentage[5]+followup_plot_vec_percentage[7],
  area3 = followup_plot_vec_percentage[1]+followup_plot_vec_percentage[5]+followup_plot_vec_percentage[6]+followup_plot_vec_percentage[7],
  n12 = followup_plot_vec_percentage[4]+followup_plot_vec_percentage[7],
  n13 = followup_plot_vec_percentage[6]+followup_plot_vec_percentage[7],
  n23 = followup_plot_vec_percentage[5]+followup_plot_vec_percentage[7],
  n123 = followup_plot_vec_percentage[7],
  category = c("Brain Imaging", "Mental Health", "Polygenic Scores"),
  fill = c("#009E73", "#D55E00", "#CC79A7"),
  lty = "dashed",
  cat.col = c("black", "black", "black"),##change the caption color
  filename = NULL,
  cex = 2, ## label font size
  cat.cex = 2,### caption font size
  lwd = 2,
  cat.fontface = "bold",
  cat.dist = c(-0.1, -0.1,-0.1), # Modified
  #cat.pos = c(-30, 150,100),# Modified
  print.mode="percent")

grid.newpage()

#grid::grid.draw(venn_plot_followup_percent)
#invisible(dev.off())

```

```{r}
overrideTriple=TRUE

venn_plot_baseline_percent <- draw.triple.venn(area1 = followup_plot_vec_percentage[2]+followup_plot_vec_percentage[6]+followup_plot_vec_percentage[4]+followup_plot_vec_percentage[7],
  area2 = followup_plot_vec_percentage[3]+followup_plot_vec_percentage[4]+followup_plot_vec_percentage[5]+followup_plot_vec_percentage[7],
  area3 = followup_plot_vec_percentage[1]+followup_plot_vec_percentage[5]+followup_plot_vec_percentage[6]+followup_plot_vec_percentage[7],
  n12 = followup_plot_vec_percentage[4]+followup_plot_vec_percentage[7],
  n13 = followup_plot_vec_percentage[6]+followup_plot_vec_percentage[7],
  n23 = followup_plot_vec_percentage[5]+followup_plot_vec_percentage[7],
  n123 = followup_plot_vec_percentage[7],
  category = c("Brain Imaging", "Mental Health", "Polygenic Scores"),
  fill = c("#009E73", "#D55E00", "#CC79A7"),
  lty = "dashed",
  cat.col = c("#009E73", "#D55E00", "#CC79A7"),
  filename = NULL,
  cex = 0.001, ## label font size
  cat.cex = 2,### caption font size
  lwd = 2,
  cat.fontface = "bold",
  cat.dist = c(0.1, 0.1,-0.15), # Modified
  cat.pos = c(5,10,-10),# Modified
  print.mode="percent",
  euler.d=F,
  scaled=F,
  reverse = F)

grid.newpage()

#grid::grid.draw(venn_plot_baseline_percent)
#invisible(dev.off())
```
 Plot without label
 
```{r}
overrideTriple=TRUE

venn_plot_baseline_percent <- draw.triple.venn(area1 = followup_plot_vec_percentage[2]+followup_plot_vec_percentage[6]+followup_plot_vec_percentage[4]+followup_plot_vec_percentage[7],
  area2 = followup_plot_vec_percentage[3]+followup_plot_vec_percentage[4]+followup_plot_vec_percentage[5]+followup_plot_vec_percentage[7],
  area3 = followup_plot_vec_percentage[1]+followup_plot_vec_percentage[5]+followup_plot_vec_percentage[6]+followup_plot_vec_percentage[7],
  n12 = followup_plot_vec_percentage[4]+followup_plot_vec_percentage[7],
  n13 = followup_plot_vec_percentage[6]+followup_plot_vec_percentage[7],
  n23 = followup_plot_vec_percentage[5]+followup_plot_vec_percentage[7],
  n123 = followup_plot_vec_percentage[7],
#  category = c("Brain Imaging", "Mental Health", "Polygenic Scores"),
  fill = c("#009E73", "#D55E00", "#CC79A7"),
  lty = "dashed",
  cat.col = c("#009E73", "#D55E00", "#CC79A7"),
  filename = NULL,
  cex = 0.001, ## label font size
  cat.cex = 2,### caption font size
  lwd = 2,
  cat.fontface = "bold",
  cat.dist = c(0.1, 0.1,-0.1), # Modified
  cat.pos = c(5,10,-10),# Modified
  print.mode="percent",
  euler.d=F,
  scaled=F,
  reverse = F)

grid.newpage()

#grid::grid.draw(venn_plot_baseline_percent)
#invisible(dev.off())
```

```{r}
venn_plot_followup_raw <- draw.triple.venn(area1 = followup_plot_vec_raw[2]+followup_plot_vec_raw[6]+followup_plot_vec_raw[4]+followup_plot_vec_raw[7],
  area2 = followup_plot_vec_raw[3]+followup_plot_vec_raw[4]+followup_plot_vec_raw[5]+followup_plot_vec_raw[7],
  area3 = followup_plot_vec_raw[1]+followup_plot_vec_raw[5]+followup_plot_vec_raw[6]+followup_plot_vec_raw[7],
  n12 = followup_plot_vec_raw[4]+followup_plot_vec_raw[7],
  n13 = followup_plot_vec_raw[6]+followup_plot_vec_raw[7],
  n23 = followup_plot_vec_raw[5]+followup_plot_vec_raw[7],
  n123 = followup_plot_vec_raw[7],
  category = c("Brain \nImaging", "Mental Health", "Polygenic \nScores"),
  fill = c("#009E73", "#D55E00", "#CC79A7"),
  lty = "dashed",
  cat.col = c("black", "black", "black"),##change the caption color
  filename = NULL,
  cex = 2, ## label font size
  cat.cex = 2,### caption font size
  lwd = 2,
  cat.fontface = "bold",
  cat.dist = c(-0.1, -0.1,-0.1), # Modified
  #cat.pos = c(-30, 150,100),# Modified
  #print.mode="percent"
  )

grid.newpage()

#grid::grid.draw(venn_plot_followup_raw)
#invisible(dev.off())

```





# commonality analysis between stacked brain scan, social demographic lifestyle, psychopathology and genetics that predicts cognition

## Compute the commonality effects

```{r}
common_analysis_gene_psy_brain_ses <- function(data_input=data_all_baseline){

  print("gene_psy_brain_ses_model")
  
  gene_psy_brain_ses_model <- lmer(gfactor ~ mental_savg+mental_cws+brain_savg+ brain_cws+ gene_savg_favg+gene_cws_cwf+sdl_savg+sdl_cws+ (1|SITE_ID_L:REL_FAMILY_ID),data = data_input)
# runs very slow with this multilevel model
 # rsq_full_model <- MuMIn::r.squaredGLMM(full_model)
rsq_gene_psy_brain_ses_model <- performance::r2(gene_psy_brain_ses_model)




  print("gene_psy_brain_model")
  
  gene_psy_brain_model <- lmer(gfactor ~ mental_savg+mental_cws+brain_savg+ brain_cws+ gene_savg_favg+gene_cws_cwf+ (1|SITE_ID_L:REL_FAMILY_ID),data = data_input)
# runs very slow with this multilevel model
 # rsq_full_model <- MuMIn::r.squaredGLMM(full_model)
rsq_gene_psy_brain_model <- performance::r2(gene_psy_brain_model)
  

 print("gene_brain_ses_model")
  
  gene_brain_ses_model <- lmer(gfactor ~ brain_savg+ brain_cws+gene_savg_favg+gene_cws_cwf+sdl_savg+sdl_cws+ (1|SITE_ID_L:REL_FAMILY_ID),data = data_input)
# runs very slow with this multilevel model
 # rsq_full_model <- MuMIn::r.squaredGLMM(full_model)
rsq_gene_brain_ses_model <- performance::r2(gene_brain_ses_model)


print("gene_psy_ses_model")
  
  gene_psy_ses_model <- lmer(gfactor ~  mental_savg+mental_cws+gene_savg_favg+gene_cws_cwf+sdl_savg+sdl_cws+ (1|SITE_ID_L:REL_FAMILY_ID),data = data_input)
# runs very slow with this multilevel model
 # rsq_full_model <- MuMIn::r.squaredGLMM(full_model)
rsq_gene_psy_ses_model <- performance::r2(gene_psy_ses_model)


print("psy_brain_ses_model")
  
psy_brain_ses_model <- lmer(gfactor ~ mental_savg+mental_cws+brain_savg+ brain_cws+ sdl_savg+sdl_cws+ (1|SITE_ID_L:REL_FAMILY_ID),data = data_input)
# runs very slow with this multilevel model
 # rsq_full_model <- MuMIn::r.squaredGLMM(full_model)
rsq_psy_brain_ses_model <- performance::r2(psy_brain_ses_model)






print("gene_ses_model")
  
  gene_ses_model <- lmer(gfactor ~ gene_savg_favg+gene_cws_cwf+sdl_savg+sdl_cws+ (1|SITE_ID_L:REL_FAMILY_ID),data = data_input)
# runs very slow with this multilevel model
 # rsq_full_model <- MuMIn::r.squaredGLMM(full_model)
rsq_gene_ses_model <- performance::r2(gene_ses_model)


print("psy_ses_model")
  
  psy_ses_model <- lmer(gfactor ~ mental_savg+mental_cws+sdl_savg+sdl_cws+ (1|SITE_ID_L:REL_FAMILY_ID),data = data_input)
# runs very slow with this multilevel model
 # rsq_full_model <- MuMIn::r.squaredGLMM(full_model)
rsq_psy_ses_model <- performance::r2(psy_ses_model)



print("brain_ses_model")
  
  brain_ses_model <- lmer(gfactor ~ brain_savg+ brain_cws+sdl_savg+sdl_cws+ (1|SITE_ID_L:REL_FAMILY_ID),data = data_input)
# runs very slow with this multilevel model
 # rsq_full_model <- MuMIn::r.squaredGLMM(full_model)
rsq_brain_ses_model <- performance::r2(brain_ses_model)



    print("brain_psy_model") 
  brain_psy_model <- lmer(gfactor ~ mental_savg+mental_cws+brain_savg+ brain_cws+(1|SITE_ID_L:REL_FAMILY_ID),data = data_input)
  rsq_brain_psy <- performance::r2(brain_psy_model)
 

  print("gene_psy_model")
  ## this model has singularity problem
  gene_psy_model <- lmer(gfactor ~mental_savg+mental_cws+gene_savg_favg+gene_cws_cwf+ (1|SITE_ID_L:REL_FAMILY_ID),data = data_input)
  rsq_gene_psy <- performance::r2(gene_psy_model)


   print("brain_gene_model") 
  brain_gene_model <- lmer(gfactor ~ brain_savg+ brain_cws+gene_savg_favg+gene_cws_cwf+ (1|SITE_ID_L:REL_FAMILY_ID),data = data_input)
  rsq_brain_gene <- performance::r2(brain_gene_model)

  
  
  
  print("ses_model")
  
  ses_model <- lmer(gfactor ~ sdl_savg+sdl_cws+ (1|SITE_ID_L:REL_FAMILY_ID),data = data_input)
# runs very slow with this multilevel model
 # rsq_full_model <- MuMIn::r.squaredGLMM(full_model)
rsq_ses_model <- performance::r2(ses_model)

  
  
  
  print("brain_model")
  brain_model <- lmer(gfactor ~ brain_savg+ brain_cws+ (1|SITE_ID_L:REL_FAMILY_ID),data = data_input)
  rsq_brain <- performance::r2(brain_model)


  print("psy_model")
  psy_model <- lmer(gfactor ~  mental_savg+mental_cws+ (1|SITE_ID_L:REL_FAMILY_ID),data = data_input)
  rsq_psy <- performance::r2(psy_model)


    print("gene_model")
  gene_model <- lmer(gfactor ~ gene_savg_favg+gene_cws_cwf+ (1|SITE_ID_L:REL_FAMILY_ID),data = data_input)
  rsp_gene <- performance::r2(gene_model)

### marginal    
    
  ### unique effects
  unique_gene_margin <- rsq_gene_psy_brain_ses_model$R2_marginal-rsq_psy_brain_ses_model$R2_marginal
 
   unique_brain_margin <- rsq_gene_psy_brain_ses_model$R2_marginal-rsq_gene_psy_ses_model$R2_marginal
  
   unique_psy_margin <- rsq_gene_psy_brain_ses_model$R2_marginal-rsq_gene_brain_ses_model$R2_marginal
  
   unique_ses_margin <- rsq_gene_psy_brain_ses_model$R2_marginal-rsq_gene_psy_brain_model$R2_marginal
### common effects between two variables
common_brain_psy_margin <- rsq_gene_brain_ses_model$R2_marginal+rsq_gene_psy_ses_model$R2_marginal-rsq_gene_ses_model$R2_marginal-rsq_gene_psy_brain_ses_model$R2_marginal
  
common_gene_psy_margin <- rsq_gene_brain_ses_model$R2_marginal+rsq_psy_brain_ses_model$R2_marginal-rsq_brain_ses_model$R2_marginal-rsq_gene_psy_brain_ses_model$R2_marginal

common_brain_gene_margin <- rsq_psy_brain_ses_model$R2_marginal+rsq_gene_psy_ses_model$R2_marginal-rsq_psy_ses_model$R2_marginal-rsq_gene_psy_brain_ses_model$R2_marginal

common_brain_ses_margin <- rsq_gene_psy_brain_model$R2_marginal+rsq_gene_psy_ses_model$R2_marginal-rsq_gene_psy$R2_marginal-rsq_gene_psy_brain_ses_model$R2_marginal

common_psy_ses_margin <- rsq_gene_psy_brain_model$R2_marginal+rsq_gene_brain_ses_model$R2_marginal-rsq_brain_gene$R2_marginal-rsq_gene_psy_brain_ses_model$R2_marginal

common_gene_ses_margin <- rsq_gene_psy_brain_model$R2_marginal+rsq_psy_brain_ses_model$R2_marginal-rsq_brain_psy$R2_marginal-rsq_gene_psy_brain_ses_model$R2_marginal
  # common effects between three variables
common_brain_gene_psy_margin <-rsq_brain_ses_model$R2_marginal+rsq_gene_ses_model$R2_marginal+rsq_psy_ses_model$R2_marginal-rsq_gene_brain_ses_model$R2_marginal-rsq_gene_psy_ses_model$R2_marginal-rsq_psy_brain_ses_model$R2_marginal-rsq_ses_model$R2_marginal+rsq_gene_psy_brain_ses_model$R2_marginal

common_ses_gene_psy_margin <-rsq_brain_ses_model$R2_marginal+rsq_brain_gene$R2_marginal+rsq_brain_psy$R2_marginal-rsq_gene_psy_brain_model$R2_marginal-rsq_gene_brain_ses_model$R2_marginal-rsq_psy_brain_ses_model$R2_marginal-rsq_brain$R2_marginal+rsq_gene_psy_brain_ses_model$R2_marginal

common_brain_ses_psy_margin <-rsq_brain_gene$R2_marginal+rsq_gene_ses_model$R2_marginal+rsq_gene_psy$R2_marginal-rsq_gene_psy_brain_model$R2_marginal-rsq_gene_brain_ses_model$R2_marginal-rsq_gene_psy_ses_model$R2_marginal-rsp_gene$R2_marginal+rsq_gene_psy_brain_ses_model$R2_marginal

common_brain_gene_ses_margin <-rsq_brain_psy$R2_marginal+rsq_gene_psy$R2_marginal+rsq_psy_ses_model$R2_marginal-rsq_gene_psy_brain_model$R2_marginal-rsq_gene_psy_ses_model$R2_marginal-rsq_psy_brain_ses_model$R2_marginal-rsq_psy$R2_marginal+rsq_gene_psy_brain_ses_model$R2_marginal

# common effects between four variables

common_brain_gene_psy_ses_margin <-rsq_ses_model$R2_marginal+rsq_brain$R2_marginal+rsq_psy$R2_marginal+rsp_gene$R2_marginal-rsq_gene_ses_model$R2_marginal-rsq_psy_ses_model$R2_marginal-rsq_brain_ses_model$R2_marginal-rsq_brain_psy$R2_marginal-rsq_gene_psy$R2_marginal-rsq_brain_gene$R2_marginal+rsq_gene_psy_brain_model$R2_marginal+rsq_gene_brain_ses_model$R2_marginal+rsq_gene_psy_ses_model$R2_marginal+rsq_psy_brain_ses_model$R2_marginal - rsq_gene_psy_brain_ses_model$R2_marginal 
  
  ### conditional
  
     
       ### unique effects
unique_gene_conditional <- rsq_gene_psy_brain_ses_model$R2_conditional-rsq_psy_brain_ses_model$R2_conditional

unique_brain_conditional <- rsq_gene_psy_brain_ses_model$R2_conditional-rsq_gene_psy_ses_model$R2_conditional

unique_psy_conditional <- rsq_gene_psy_brain_ses_model$R2_conditional-rsq_gene_brain_ses_model$R2_conditional

unique_ses_conditional <- rsq_gene_psy_brain_ses_model$R2_conditional-rsq_gene_psy_brain_model$R2_conditional
### common effects between two variables
common_brain_psy_conditional <- rsq_gene_brain_ses_model$R2_conditional+rsq_gene_psy_ses_model$R2_conditional-rsq_gene_ses_model$R2_conditional-rsq_gene_psy_brain_ses_model$R2_conditional

common_gene_psy_conditional <- rsq_gene_brain_ses_model$R2_conditional+rsq_psy_brain_ses_model$R2_conditional-rsq_brain_ses_model$R2_conditional-rsq_gene_psy_brain_ses_model$R2_conditional

common_brain_gene_conditional <- 
rsq_psy_brain_ses_model$R2_conditional+rsq_gene_psy_ses_model$R2_conditional-rsq_psy_ses_model$R2_conditional-rsq_gene_psy_brain_ses_model$R2_conditional

common_brain_ses_conditional <- rsq_gene_psy_brain_model$R2_conditional+rsq_gene_psy_ses_model$R2_conditional-rsq_gene_psy$R2_conditional-rsq_gene_psy_brain_ses_model$R2_conditional

common_psy_ses_conditional <- rsq_gene_psy_brain_model$R2_conditional+rsq_gene_brain_ses_model$R2_conditional-rsq_brain_gene$R2_conditional-rsq_gene_psy_brain_ses_model$R2_conditional

common_gene_ses_conditional <- rsq_gene_psy_brain_model$R2_conditional+rsq_psy_brain_ses_model$R2_conditional-rsq_brain_psy$R2_conditional-rsq_gene_psy_brain_ses_model$R2_conditional
  # common effects between three variables

common_brain_gene_psy_conditional <-rsq_brain_ses_model$R2_conditional+rsq_gene_ses_model$R2_conditional+rsq_psy_ses_model$R2_conditional-rsq_gene_brain_ses_model$R2_conditional-rsq_gene_psy_ses_model$R2_conditional-rsq_psy_brain_ses_model$R2_conditional-rsq_ses_model$R2_conditional+rsq_gene_psy_brain_ses_model$R2_conditional

common_ses_gene_psy_conditional <-rsq_brain_ses_model$R2_conditional+rsq_brain_gene$R2_conditional+rsq_brain_psy$R2_conditional-rsq_gene_psy_brain_model$R2_conditional-rsq_gene_brain_ses_model$R2_conditional-rsq_psy_brain_ses_model$R2_conditional-rsq_brain$R2_conditional+rsq_gene_psy_brain_ses_model$R2_conditional

common_brain_ses_psy_conditional <-rsq_brain_gene$R2_conditional+rsq_gene_ses_model$R2_conditional+rsq_gene_psy$R2_conditional-rsq_gene_psy_brain_model$R2_conditional-rsq_gene_brain_ses_model$R2_conditional-rsq_gene_psy_ses_model$R2_conditional-rsp_gene$R2_conditional+rsq_gene_psy_brain_ses_model$R2_conditional

common_brain_gene_ses_conditional <-rsq_brain_psy$R2_conditional+rsq_gene_psy$R2_conditional+rsq_psy_ses_model$R2_conditional-rsq_gene_psy_brain_model$R2_conditional-rsq_gene_psy_ses_model$R2_conditional-rsq_psy_brain_ses_model$R2_conditional-rsq_psy$R2_conditional+rsq_gene_psy_brain_ses_model$R2_conditional

# common effects between four variables
common_brain_gene_psy_ses_conditional <-rsq_ses_model$R2_conditional+rsq_brain$R2_conditional+rsq_psy$R2_conditional+rsp_gene$R2_conditional-rsq_gene_ses_model$R2_conditional-rsq_psy_ses_model$R2_conditional-rsq_brain_ses_model$R2_conditional-rsq_brain_psy$R2_conditional-rsq_gene_psy$R2_conditional-rsq_brain_gene$R2_conditional+rsq_gene_psy_brain_model$R2_conditional+rsq_gene_brain_ses_model$R2_conditional+rsq_gene_psy_ses_model$R2_conditional+rsq_psy_brain_ses_model$R2_conditional - rsq_gene_psy_brain_ses_model$R2_conditional 

## anova analysis

ses_significance <- anova(gene_psy_brain_ses_model,gene_psy_brain_model)

psy_significance <- anova(gene_psy_brain_ses_model,gene_brain_ses_model)

brain_significance <- anova(gene_psy_brain_ses_model,gene_psy_ses_model)

gene_significance <- anova(gene_psy_brain_ses_model,psy_brain_ses_model)

psy_ses_ses <- anova(psy_ses_model,psy_model)
psy_ses_psy <- anova(psy_ses_model,ses_model)

brain_psy_brain <- anova(brain_psy_model,psy_model)
brain_psy_psy <- anova(brain_psy_model,brain_model)

gene_psy_psy <- anova(gene_psy_model, gene_model)
gene_psy_gene <- anova(gene_psy_model, psy_model)

  output_common_tibble <- tibble(variable_effects = c("unique_gene",
                                               "unique_brain",
                                              "unique_psy",
                                              "unique_ses",
                                              "common_brain_psy",
                                              "common_gene_psy",
                                              "common_brain_gene",
                                              "common_brain_ses",
                                              "common_psy_ses",
                                              "common_gene_ses",
                                              "common_brain_gene_psy",
                                              "common_ses_gene_psy",
                                              "common_brain_ses_psy",
                                              "common_brain_gene_ses",
                                              "common_brain_gene_psy_ses"),
                          marginal_rsq = c(unique_gene_margin,
                                              unique_brain_margin,
                                              unique_psy_margin,
                                           unique_ses_margin,
                                              common_brain_psy_margin,
                                              common_gene_psy_margin,
                                              common_brain_gene_margin,
                                           common_brain_ses_margin,
                                           common_psy_ses_margin,
                                           common_gene_ses_margin,
                                              common_brain_gene_psy_margin,
                                          common_ses_gene_psy_margin,
                                          common_brain_ses_psy_margin,
                                          common_brain_gene_ses_margin,
                                          common_brain_gene_psy_ses_margin),
                          conditional_rsq = c(unique_gene_conditional,
                                              unique_brain_conditional,
                                              unique_psy_conditional,
                                              unique_ses_conditional,
                                              common_brain_psy_conditional,
                                              common_gene_psy_conditional,
                                              common_brain_gene_conditional,
                                              common_brain_ses_conditional,
                                              common_psy_ses_conditional,
                                              common_gene_ses_conditional,
                                              common_brain_gene_psy_conditional,
                                              common_ses_gene_psy_conditional,
                                              common_brain_ses_psy_conditional,
                                              common_brain_gene_ses_conditional,
                                              common_brain_gene_psy_ses_conditional))
  output_rsq_tibble <- tibble(model_names<- c("gene",
                                               "brain",
                                              "psy",
                                              "ses",
                                              "brain_psy",
                                              "gene_psy",
                                              "brain_gene",
                                              "brain_ses",
                                              "psy_ses",
                                              "gene_ses",
                                              "brain_gene_psy",
                                              "ses_gene_psy",
                                              "brain_ses_psy",
                                              "brain_gene_ses",
                                              "brain_gene_psy_ses"),
                          marginal_rsq = c(rsp_gene$R2_marginal,
                                              rsq_brain$R2_marginal,
                                              rsq_psy$R2_marginal,
                                           rsq_ses_model$R2_marginal,
                                              rsq_brain_psy$R2_marginal,
                                              rsq_gene_psy$R2_marginal,
                                              rsq_brain_gene$R2_marginal,
                                           rsq_brain_ses_model$R2_marginal,
                                           rsq_psy_ses_model$R2_marginal,
                                           rsq_gene_ses_model$R2_marginal,
                                              rsq_gene_psy_brain_model$R2_marginal,
                                           rsq_gene_psy_ses_model$R2_marginal,
                                           rsq_psy_brain_ses_model$R2_marginal,
                                          rsq_gene_brain_ses_model$R2_marginal,
                                          rsq_gene_psy_brain_ses_model$R2_marginal),
                          conditional_rsq = c(rsp_gene$R2_conditional,
                                              rsq_brain$R2_conditional,
                                              rsq_psy$R2_conditional,
                                           rsq_ses_model$R2_conditional,
                                              rsq_brain_psy$R2_conditional,
                                              rsq_gene_psy$R2_conditional,
                                              rsq_brain_gene$R2_conditional,
                                           rsq_brain_ses_model$R2_conditional,
                                           rsq_psy_ses_model$R2_conditional,
                                           rsq_gene_ses_model$R2_conditional,
                                              rsq_gene_psy_brain_model$R2_conditional,
                                           rsq_gene_psy_ses_model$R2_conditional,
                                           rsq_psy_brain_ses_model$R2_conditional,
                                          rsq_gene_brain_ses_model$R2_conditional,
                                          rsq_gene_psy_brain_ses_model$R2_conditional))
  
  return(list(output_common_tibble=output_common_tibble,
              output_rsq_tibble=output_rsq_tibble,
              gene_psy_brain_ses_model=gene_psy_brain_ses_model,
              gene_psy_brain_model=gene_psy_brain_model,
              gene_brain_ses_model=gene_brain_ses_model,
              gene_psy_ses_model=gene_psy_ses_model,
              psy_brain_ses_model=psy_brain_ses_model,
              gene_ses_model=gene_ses_model,
              psy_ses_model=psy_ses_model,
              brain_ses_model=brain_ses_model,
              brain_psy_model=brain_psy_model,
              gene_psy_model=gene_psy_model,
              brain_gene_model=brain_gene_model,
              ses_model=ses_model,
              brain_model=brain_model,
              psy_model=psy_model,
              gene_model=gene_model,
              ses_significance=ses_significance,
              psy_significance=psy_significance,
              brain_significance=brain_significance,
              gene_significance=gene_significance,
              psy_ses_ses = psy_ses_ses,
              psy_ses_psy=psy_ses_psy,
              brain_psy_brain = brain_psy_brain,
              brain_psy_psy = brain_psy_psy,
              gene_psy_psy = gene_psy_psy,
              gene_psy_gene = gene_psy_gene
             ))
  }
```



```{r}
common_analysis_gene_psy_brain_ses_baseline <-common_analysis_gene_psy_brain_ses(data_input=data_all_baseline)




common_analysis_gene_psy_brain_ses_followup <-common_analysis_gene_psy_brain_ses(data_input=data_all_followup)



```

checking the significant level of the unique effects of the four feature model

```{r}
## baseline

common_analysis_gene_psy_brain_ses_baseline[["ses_significance"]]

common_analysis_gene_psy_brain_ses_baseline[["psy_significance"]]

common_analysis_gene_psy_brain_ses_baseline[["brain_significance"]]

common_analysis_gene_psy_brain_ses_baseline[["gene_significance"]]

common_analysis_gene_psy_brain_ses_followup[["ses_significance"]]

common_analysis_gene_psy_brain_ses_followup[["psy_significance"]]

common_analysis_gene_psy_brain_ses_followup[["brain_significance"]]

common_analysis_gene_psy_brain_ses_followup[["gene_significance"]]



```

checking the significance level of the two features models

```{r}
common_analysis_gene_psy_brain_ses_baseline[["psy_ses_ses"]] 
 common_analysis_gene_psy_brain_ses_baseline[["psy_ses_psy"]]       


common_analysis_gene_psy_brain_ses_followup[["psy_ses_ses"]] 
 common_analysis_gene_psy_brain_ses_followup[["psy_ses_psy"]]       
```

```{r}
common_analysis_gene_psy_brain_ses_baseline[["brain_psy_brain"]]               
common_analysis_gene_psy_brain_ses_baseline[["brain_psy_psy"]]          

 common_analysis_gene_psy_brain_ses_followup[["brain_psy_brain"]]               
common_analysis_gene_psy_brain_ses_followup[["brain_psy_psy"]]  
```


```{r}
common_analysis_gene_psy_brain_ses_baseline[["gene_psy_psy"]]               
common_analysis_gene_psy_brain_ses_baseline[["gene_psy_gene"]]      

common_analysis_gene_psy_brain_ses_followup[["gene_psy_psy"]]               
common_analysis_gene_psy_brain_ses_followup[["gene_psy_gene"]]     
```

## processing the results and plotting


This chunk needs to be checked manually for every analysis.

```{r}
baseline_gene_psy_brain_ses_vec <- common_analysis_gene_psy_brain_ses_baseline[[1]]$marginal_rsq

### get rid of the negative values
baseline_gene_psy_brain_ses_vec_corrected <- baseline_gene_psy_brain_ses_vec 
#baseline_gene_psy_brain_ses_vec_corrected[14] <- 0


baseline_gene_psy_brain_ses_vec_corrected_percent <- baseline_gene_psy_brain_ses_vec_corrected/sum(baseline_gene_psy_brain_ses_vec_corrected)*100 
baseline_gene_psy_brain_ses_vec_corrected_percent <- round(baseline_gene_psy_brain_ses_vec_corrected_percent,2)
print(baseline_gene_psy_brain_ses_vec_corrected_percent)



baseline_gene_psy_brain_ses_vec_corrected_raw <- baseline_gene_psy_brain_ses_vec_corrected*100 
#baseline_gene_psy_brain_ses_vec_corrected_raw <- round(baseline_gene_psy_brain_ses_vec_corrected_raw,2)
print(baseline_gene_psy_brain_ses_vec_corrected_raw)

### manually assign values because there is some weird thing with label, to get the rounding at the plots right
#baseline_gene_psy_brain_ses_vec_corrected_raw[1]<- 0.02496
#baseline_gene_psy_brain_ses_vec_corrected_raw[6]<- 0.022
#baseline_gene_psy_brain_ses_vec_corrected_raw[7]<- 0.081


followup_gene_psy_brain_ses_vec <- common_analysis_gene_psy_brain_ses_followup[[1]]$marginal_rsq



### get rid of the negative values
followup_gene_psy_brain_ses_vec_corrected <- followup_gene_psy_brain_ses_vec 
followup_gene_psy_brain_ses_vec_corrected[10] <- 0


followup_gene_psy_brain_ses_vec_corrected_percentage <- followup_gene_psy_brain_ses_vec_corrected/sum(followup_gene_psy_brain_ses_vec_corrected)*100
followup_gene_psy_brain_ses_vec_corrected_percentage <- round(followup_gene_psy_brain_ses_vec_corrected_percentage,2)
print(followup_gene_psy_brain_ses_vec_corrected_percentage)



followup_gene_psy_brain_ses_vec_corrected_raw <- followup_gene_psy_brain_ses_vec_corrected*100 
#followup_gene_psy_brain_ses_vec_corrected_raw <- round(followup_gene_psy_brain_ses_vec_corrected_raw,2)
print(followup_gene_psy_brain_ses_vec_corrected_raw)
```

## table results

```{r}

baseline_table <- common_analysis_gene_psy_brain_ses_baseline[[1]]%>%
                  mutate(corrected_percent = baseline_gene_psy_brain_ses_vec_corrected_percent)%>% 
                  mutate(corrected_raw = baseline_gene_psy_brain_ses_vec_corrected_raw)




baseline_table%>% 
    kableExtra::kbl(caption = "Commonality analysis in baseline") %>%
    kableExtra::kable_classic(full_width = F, 
                             html_font = "Cambria")
common_analysis_gene_psy_brain_ses_baseline[[2]]%>% 
    kableExtra::kbl(caption = "R^2 metrics for all models in baseline") %>%
    kableExtra::kable_classic(full_width = F, 
                             html_font = "Cambria")

followup_table <- common_analysis_gene_psy_brain_ses_followup[[1]]%>% 
                 mutate(correted_percent = followup_gene_psy_brain_ses_vec_corrected_percentage)%>%
                 mutate(corrected_raw = followup_gene_psy_brain_ses_vec_corrected_raw)




followup_table%>% 
    kableExtra::kbl(caption = "Commonality analysis in followup") %>%
    kableExtra::kable_classic(full_width = F, 
                             html_font = "Cambria")
common_analysis_gene_psy_brain_ses_followup[[2]]%>% 
    kableExtra::kbl(caption = "R^2 metrics for all models in followup") %>%
    kableExtra::kable_classic(full_width = F, 
                             html_font = "Cambria")

```

## Print mixed model output

Linear mixed models at baseline:

```{r}

tab_model(common_analysis_gene_psy_brain_ses_baseline$gene_psy_brain_ses_model,
          common_analysis_gene_psy_brain_ses_baseline$gene_psy_brain_model,
          common_analysis_gene_psy_brain_ses_baseline$gene_psy_ses_model,
          common_analysis_gene_psy_brain_ses_baseline$psy_brain_ses_model,
          common_analysis_gene_psy_brain_ses_baseline$gene_brain_ses_model,
          common_analysis_gene_psy_brain_ses_baseline$psy_ses_model,
          common_analysis_gene_psy_brain_ses_baseline$brain_ses_model,
          common_analysis_gene_psy_brain_ses_baseline$brain_psy_model,
          common_analysis_gene_psy_brain_ses_baseline$gene_psy_model,
          common_analysis_gene_psy_brain_ses_baseline$brain_gene_model,
          common_analysis_gene_psy_brain_ses_baseline$gene_ses_model,
          common_analysis_gene_psy_brain_ses_baseline$ses_model,
          common_analysis_gene_psy_brain_ses_baseline$brain_model,
          common_analysis_gene_psy_brain_ses_baseline$psy_model,
          common_analysis_gene_psy_brain_ses_baseline$gene_model)

### print individual linear mixed models for Polygenic Scores at baseline

## model with all four features

tab_model(common_analysis_gene_psy_brain_ses_baseline$gene_psy_brain_ses_model)

## model with mental health and social demographic lifestyle developmental

tab_model(common_analysis_gene_psy_brain_ses_baseline$psy_ses_model)

### model with brain MRI and mental health

tab_model(common_analysis_gene_psy_brain_ses_baseline$brain_psy_model)

### model with gene and mental health

tab_model(common_analysis_gene_psy_brain_ses_baseline$gene_psy_model,
          common_analysis_gene_psy_brain_ses_baseline$psy_model,
          common_analysis_gene_psy_brain_ses_baseline$gene_model
          )


tab_model(common_analysis_gene_psy_brain_ses_baseline$gene_psy_brain_ses_model,
common_analysis_gene_psy_brain_ses_baseline$brain_psy_model,
common_analysis_gene_psy_brain_ses_baseline$gene_psy_model,
common_analysis_gene_psy_brain_ses_baseline$psy_ses_model)
```


Linear mixed models at followup

```{r}
tab_model(common_analysis_gene_psy_brain_ses_followup$gene_psy_brain_ses_model,
          common_analysis_gene_psy_brain_ses_followup$gene_psy_brain_model,
          common_analysis_gene_psy_brain_ses_followup$gene_psy_ses_model,
          common_analysis_gene_psy_brain_ses_followup$psy_brain_ses_model,
          common_analysis_gene_psy_brain_ses_followup$gene_brain_ses_model,
          common_analysis_gene_psy_brain_ses_followup$psy_ses_model,
          common_analysis_gene_psy_brain_ses_followup$brain_ses_model,
          common_analysis_gene_psy_brain_ses_followup$brain_psy_model,
          common_analysis_gene_psy_brain_ses_followup$gene_psy_model,
          common_analysis_gene_psy_brain_ses_followup$brain_gene_model,
          common_analysis_gene_psy_brain_ses_followup$gene_ses_model,
          common_analysis_gene_psy_brain_ses_followup$ses_model,
          common_analysis_gene_psy_brain_ses_followup$brain_model,
          common_analysis_gene_psy_brain_ses_followup$psy_model,
          common_analysis_gene_psy_brain_ses_followup$gene_model)

### print individual linear mixed models for Polygenic Scores at followup

## model with all four features

tab_model(common_analysis_gene_psy_brain_ses_followup$gene_psy_brain_ses_model)

## model with mental health and social demographic lifestyle developmental

tab_model(common_analysis_gene_psy_brain_ses_followup$psy_ses_model)

### model with brain MRI and mental health

tab_model(common_analysis_gene_psy_brain_ses_followup$brain_psy_model)

### model with gene and mental health

tab_model(common_analysis_gene_psy_brain_ses_followup$gene_psy_model,
          common_analysis_gene_psy_brain_ses_followup$psy_model,
          common_analysis_gene_psy_brain_ses_followup$gene_model)

tab_model(common_analysis_gene_psy_brain_ses_followup$gene_psy_brain_ses_model,
common_analysis_gene_psy_brain_ses_followup$brain_psy_model,
common_analysis_gene_psy_brain_ses_followup$gene_psy_model,
common_analysis_gene_psy_brain_ses_followup$psy_ses_model)
```



## Baseline percentage of rsquare plot

```{r,fig.height=10,fig.width=10}
overrideTriple=TRUE

quad_venn_baseline_percent <- draw.quad.venn(area1 = baseline_gene_psy_brain_ses_vec_corrected_percent[2]+baseline_gene_psy_brain_ses_vec_corrected_percent[5]+baseline_gene_psy_brain_ses_vec_corrected_percent[7]+baseline_gene_psy_brain_ses_vec_corrected_percent[8]+baseline_gene_psy_brain_ses_vec_corrected_percent[11]+baseline_gene_psy_brain_ses_vec_corrected_percent[13]+baseline_gene_psy_brain_ses_vec_corrected_percent[14]+baseline_gene_psy_brain_ses_vec_corrected_percent[15],
  area2 = baseline_gene_psy_brain_ses_vec_corrected_percent[3]+baseline_gene_psy_brain_ses_vec_corrected_percent[5]+baseline_gene_psy_brain_ses_vec_corrected_percent[6]+baseline_gene_psy_brain_ses_vec_corrected_percent[9]+baseline_gene_psy_brain_ses_vec_corrected_percent[11]+baseline_gene_psy_brain_ses_vec_corrected_percent[12]+baseline_gene_psy_brain_ses_vec_corrected_percent[13]+baseline_gene_psy_brain_ses_vec_corrected_percent[15],
  area3 = baseline_gene_psy_brain_ses_vec_corrected_percent[1]+baseline_gene_psy_brain_ses_vec_corrected_percent[6]+baseline_gene_psy_brain_ses_vec_corrected_percent[7]+baseline_gene_psy_brain_ses_vec_corrected_percent[10]+baseline_gene_psy_brain_ses_vec_corrected_percent[11]+baseline_gene_psy_brain_ses_vec_corrected_percent[12]+baseline_gene_psy_brain_ses_vec_corrected_percent[14]+baseline_gene_psy_brain_ses_vec_corrected_percent[15],
  area4 =  baseline_gene_psy_brain_ses_vec_corrected_percent[4]+baseline_gene_psy_brain_ses_vec_corrected_percent[8]+baseline_gene_psy_brain_ses_vec_corrected_percent[9]+baseline_gene_psy_brain_ses_vec_corrected_percent[10]+baseline_gene_psy_brain_ses_vec_corrected_percent[12]+baseline_gene_psy_brain_ses_vec_corrected_percent[13]+baseline_gene_psy_brain_ses_vec_corrected_percent[14]+baseline_gene_psy_brain_ses_vec_corrected_percent[15],
  n12 = baseline_gene_psy_brain_ses_vec_corrected_percent[5]+baseline_gene_psy_brain_ses_vec_corrected_percent[11]+baseline_gene_psy_brain_ses_vec_corrected_percent[13]+baseline_gene_psy_brain_ses_vec_corrected_percent[15],
  n13 = baseline_gene_psy_brain_ses_vec_corrected_percent[7]+baseline_gene_psy_brain_ses_vec_corrected_percent[11]+baseline_gene_psy_brain_ses_vec_corrected_percent[14]+baseline_gene_psy_brain_ses_vec_corrected_percent[15],
  n23 = baseline_gene_psy_brain_ses_vec_corrected_percent[6]+baseline_gene_psy_brain_ses_vec_corrected_percent[11]+baseline_gene_psy_brain_ses_vec_corrected_percent[12]+baseline_gene_psy_brain_ses_vec_corrected_percent[15],
  n14 = baseline_gene_psy_brain_ses_vec_corrected_percent[8]+baseline_gene_psy_brain_ses_vec_corrected_percent[13]+baseline_gene_psy_brain_ses_vec_corrected_percent[14]+baseline_gene_psy_brain_ses_vec_corrected_percent[15],
  n24 = baseline_gene_psy_brain_ses_vec_corrected_percent[9]+baseline_gene_psy_brain_ses_vec_corrected_percent[12]+baseline_gene_psy_brain_ses_vec_corrected_percent[13]+baseline_gene_psy_brain_ses_vec_corrected_percent[15],
  n34 = baseline_gene_psy_brain_ses_vec_corrected_percent[10]+baseline_gene_psy_brain_ses_vec_corrected_percent[12]+baseline_gene_psy_brain_ses_vec_corrected_percent[14]+baseline_gene_psy_brain_ses_vec_corrected_percent[15],
  n123 = baseline_gene_psy_brain_ses_vec_corrected_percent[11]+baseline_gene_psy_brain_ses_vec_corrected_percent[15],
  n124 = baseline_gene_psy_brain_ses_vec_corrected_percent[13]+baseline_gene_psy_brain_ses_vec_corrected_percent[15],
  n134 = baseline_gene_psy_brain_ses_vec_corrected_percent[14]+baseline_gene_psy_brain_ses_vec_corrected_percent[15],
  n234 = baseline_gene_psy_brain_ses_vec_corrected_percent[12]+baseline_gene_psy_brain_ses_vec_corrected_percent[15],
  n1234 = baseline_gene_psy_brain_ses_vec_corrected_percent[15],
  category = c("Brain \nImaging", "Mental \nHealth", "Polygenic \nScores","SD LS \nDev Adv"),
  fill = c("#009E73", "#D55E00", "#CC79A7","#999999"),
  lty = "dashed",
  cat.col = c("#009E73", "#D55E00", "#CC79A7","#999999"),
  filename = NULL,
  cex = 0.001, ## label font size
  cat.cex = 2,### caption font size
  lwd = 2,
  cat.fontface = "bold",
  cat.dist = c(0.2, 0.2,0.1,0.1), # Modified
  cat.pos = c(1,1,1,1),# Modified
  print.mode="percent",
  euler.d=F,
  scaled=F,
  reverse = F,
  direct.area=TRUE)

grid.newpage()

#grid::grid.draw(quad_venn_baseline_percent)
#invisible(dev.off())
```

The plot with label.

```{r,fig.height=10,fig.width=10}
#overrideTriple=TRUE

quad_venn_baseline_percent_label <- draw.quad.venn(area1 = baseline_gene_psy_brain_ses_vec_corrected_percent[2]+baseline_gene_psy_brain_ses_vec_corrected_percent[5]+baseline_gene_psy_brain_ses_vec_corrected_percent[7]+baseline_gene_psy_brain_ses_vec_corrected_percent[8]+baseline_gene_psy_brain_ses_vec_corrected_percent[11]+baseline_gene_psy_brain_ses_vec_corrected_percent[13]+baseline_gene_psy_brain_ses_vec_corrected_percent[14]+baseline_gene_psy_brain_ses_vec_corrected_percent[15],
  area2 = baseline_gene_psy_brain_ses_vec_corrected_percent[3]+baseline_gene_psy_brain_ses_vec_corrected_percent[5]+baseline_gene_psy_brain_ses_vec_corrected_percent[6]+baseline_gene_psy_brain_ses_vec_corrected_percent[9]+baseline_gene_psy_brain_ses_vec_corrected_percent[11]+baseline_gene_psy_brain_ses_vec_corrected_percent[12]+baseline_gene_psy_brain_ses_vec_corrected_percent[13]+baseline_gene_psy_brain_ses_vec_corrected_percent[15],
  area3 = baseline_gene_psy_brain_ses_vec_corrected_percent[1]+baseline_gene_psy_brain_ses_vec_corrected_percent[6]+baseline_gene_psy_brain_ses_vec_corrected_percent[7]+baseline_gene_psy_brain_ses_vec_corrected_percent[10]+baseline_gene_psy_brain_ses_vec_corrected_percent[11]+baseline_gene_psy_brain_ses_vec_corrected_percent[12]+baseline_gene_psy_brain_ses_vec_corrected_percent[14]+baseline_gene_psy_brain_ses_vec_corrected_percent[15],
  area4 =  baseline_gene_psy_brain_ses_vec_corrected_percent[4]+baseline_gene_psy_brain_ses_vec_corrected_percent[8]+baseline_gene_psy_brain_ses_vec_corrected_percent[9]+baseline_gene_psy_brain_ses_vec_corrected_percent[10]+baseline_gene_psy_brain_ses_vec_corrected_percent[12]+baseline_gene_psy_brain_ses_vec_corrected_percent[13]+baseline_gene_psy_brain_ses_vec_corrected_percent[14]+baseline_gene_psy_brain_ses_vec_corrected_percent[15],
  n12 = baseline_gene_psy_brain_ses_vec_corrected_percent[5]+baseline_gene_psy_brain_ses_vec_corrected_percent[11]+baseline_gene_psy_brain_ses_vec_corrected_percent[13]+baseline_gene_psy_brain_ses_vec_corrected_percent[15],
  n13 = baseline_gene_psy_brain_ses_vec_corrected_percent[7]+baseline_gene_psy_brain_ses_vec_corrected_percent[11]+baseline_gene_psy_brain_ses_vec_corrected_percent[14]+baseline_gene_psy_brain_ses_vec_corrected_percent[15],
  n23 = baseline_gene_psy_brain_ses_vec_corrected_percent[6]+baseline_gene_psy_brain_ses_vec_corrected_percent[11]+baseline_gene_psy_brain_ses_vec_corrected_percent[12]+baseline_gene_psy_brain_ses_vec_corrected_percent[15],
  n14 = baseline_gene_psy_brain_ses_vec_corrected_percent[8]+baseline_gene_psy_brain_ses_vec_corrected_percent[13]+baseline_gene_psy_brain_ses_vec_corrected_percent[14]+baseline_gene_psy_brain_ses_vec_corrected_percent[15],
  n24 = baseline_gene_psy_brain_ses_vec_corrected_percent[9]+baseline_gene_psy_brain_ses_vec_corrected_percent[12]+baseline_gene_psy_brain_ses_vec_corrected_percent[13]+baseline_gene_psy_brain_ses_vec_corrected_percent[15],
  n34 = baseline_gene_psy_brain_ses_vec_corrected_percent[10]+baseline_gene_psy_brain_ses_vec_corrected_percent[12]+baseline_gene_psy_brain_ses_vec_corrected_percent[14]+baseline_gene_psy_brain_ses_vec_corrected_percent[15],
  n123 = baseline_gene_psy_brain_ses_vec_corrected_percent[11]+baseline_gene_psy_brain_ses_vec_corrected_percent[15],
  n124 = baseline_gene_psy_brain_ses_vec_corrected_percent[13]+baseline_gene_psy_brain_ses_vec_corrected_percent[15],
  n134 = baseline_gene_psy_brain_ses_vec_corrected_percent[14]+baseline_gene_psy_brain_ses_vec_corrected_percent[15],
  n234 = baseline_gene_psy_brain_ses_vec_corrected_percent[12]+baseline_gene_psy_brain_ses_vec_corrected_percent[15],
  n1234 = baseline_gene_psy_brain_ses_vec_corrected_percent[15],
  category = c("Brain \nImaging", "Mental \nHealth", "Polygenic \nScores","SD LS \nDev Adv"),
  fill = c("#009E73", "#D55E00", "#CC79A7","#999999"),
  lty = "dashed",
  cat.col = c("#009E73", "#D55E00", "#CC79A7","#999999"),
    filename = NULL,
  cex = 2, ## label font size
  cat.cex = 2.5,### caption font size
  lwd = 2,
  cat.fontface = "bold",
  cat.dist = c(0.2, 0.2,0.1,0.1), # Modified
  cat.pos = c(1,1,1,1),# Modified
  print.mode="percent"
  )


grid.newpage()

#grid::grid.draw(quad_venn_baseline_percent_label)
#invisible(dev.off())
```

The raw r-squared plot.

```{r,fig.height=10,fig.width=10}
overrideTriple=TRUE

quad_venn_baseline_raw <- draw.quad.venn(area1 = baseline_gene_psy_brain_ses_vec_corrected_raw[2]+baseline_gene_psy_brain_ses_vec_corrected_raw[5]+baseline_gene_psy_brain_ses_vec_corrected_raw[7]+baseline_gene_psy_brain_ses_vec_corrected_raw[8]+baseline_gene_psy_brain_ses_vec_corrected_raw[11]+baseline_gene_psy_brain_ses_vec_corrected_raw[13]+baseline_gene_psy_brain_ses_vec_corrected_raw[14]+baseline_gene_psy_brain_ses_vec_corrected_raw[15],
  area2 = baseline_gene_psy_brain_ses_vec_corrected_raw[3]+baseline_gene_psy_brain_ses_vec_corrected_raw[5]+baseline_gene_psy_brain_ses_vec_corrected_raw[6]+baseline_gene_psy_brain_ses_vec_corrected_raw[9]+baseline_gene_psy_brain_ses_vec_corrected_raw[11]+baseline_gene_psy_brain_ses_vec_corrected_raw[12]+baseline_gene_psy_brain_ses_vec_corrected_raw[13]+baseline_gene_psy_brain_ses_vec_corrected_raw[15],
  area3 = baseline_gene_psy_brain_ses_vec_corrected_raw[1]+baseline_gene_psy_brain_ses_vec_corrected_raw[6]+baseline_gene_psy_brain_ses_vec_corrected_raw[7]+baseline_gene_psy_brain_ses_vec_corrected_raw[10]+baseline_gene_psy_brain_ses_vec_corrected_raw[11]+baseline_gene_psy_brain_ses_vec_corrected_raw[12]+baseline_gene_psy_brain_ses_vec_corrected_raw[14]+baseline_gene_psy_brain_ses_vec_corrected_raw[15],
  area4 =  baseline_gene_psy_brain_ses_vec_corrected_raw[4]+baseline_gene_psy_brain_ses_vec_corrected_raw[8]+baseline_gene_psy_brain_ses_vec_corrected_raw[9]+baseline_gene_psy_brain_ses_vec_corrected_raw[10]+baseline_gene_psy_brain_ses_vec_corrected_raw[12]+baseline_gene_psy_brain_ses_vec_corrected_raw[13]+baseline_gene_psy_brain_ses_vec_corrected_raw[14]+baseline_gene_psy_brain_ses_vec_corrected_raw[15],
  n12 = baseline_gene_psy_brain_ses_vec_corrected_raw[5]+baseline_gene_psy_brain_ses_vec_corrected_raw[11]+baseline_gene_psy_brain_ses_vec_corrected_raw[13]+baseline_gene_psy_brain_ses_vec_corrected_raw[15],
  n13 = baseline_gene_psy_brain_ses_vec_corrected_raw[7]+baseline_gene_psy_brain_ses_vec_corrected_raw[11]+baseline_gene_psy_brain_ses_vec_corrected_raw[14]+baseline_gene_psy_brain_ses_vec_corrected_raw[15],
  n23 = baseline_gene_psy_brain_ses_vec_corrected_raw[6]+baseline_gene_psy_brain_ses_vec_corrected_raw[11]+baseline_gene_psy_brain_ses_vec_corrected_raw[12]+baseline_gene_psy_brain_ses_vec_corrected_raw[15],
  n14 = baseline_gene_psy_brain_ses_vec_corrected_raw[8]+baseline_gene_psy_brain_ses_vec_corrected_raw[13]+baseline_gene_psy_brain_ses_vec_corrected_raw[14]+baseline_gene_psy_brain_ses_vec_corrected_raw[15],
  n24 = baseline_gene_psy_brain_ses_vec_corrected_raw[9]+baseline_gene_psy_brain_ses_vec_corrected_raw[12]+baseline_gene_psy_brain_ses_vec_corrected_raw[13]+baseline_gene_psy_brain_ses_vec_corrected_raw[15],
  n34 = baseline_gene_psy_brain_ses_vec_corrected_raw[10]+baseline_gene_psy_brain_ses_vec_corrected_raw[12]+baseline_gene_psy_brain_ses_vec_corrected_raw[14]+baseline_gene_psy_brain_ses_vec_corrected_raw[15],
  n123 = baseline_gene_psy_brain_ses_vec_corrected_raw[11]+baseline_gene_psy_brain_ses_vec_corrected_raw[15],
  n124 = baseline_gene_psy_brain_ses_vec_corrected_raw[13]+baseline_gene_psy_brain_ses_vec_corrected_raw[15],
  n134 = baseline_gene_psy_brain_ses_vec_corrected_raw[14]+baseline_gene_psy_brain_ses_vec_corrected_raw[15],
  n234 = baseline_gene_psy_brain_ses_vec_corrected_raw[12]+baseline_gene_psy_brain_ses_vec_corrected_raw[15],
  n1234 = baseline_gene_psy_brain_ses_vec_corrected_raw[15],
  category = c("Brain \nImaging", "Mental Health", "Polygenic \nScores","SD LS \nDev Adv"),
  fill = c("#009E73", "#D55E00", "#CC79A7","#999999"),
  lty = "dashed",
  cat.col = c("#009E73", "#D55E00", "#CC79A7","#999999"),
  filename = NULL,
  cex = 0.001, ## label font size
  cat.cex = 2,### caption font size
  lwd = 2,
  cat.fontface = "bold",
  cat.dist = c(0.2, 0.2,0.1,0.1), # Modified
  cat.pos = c(1,1,1,1),# Modified
  print.mode="percent",
  euler.d=F,
  scaled=F,
  reverse = F,
  direct.area=TRUE)

grid.newpage()

#grid::grid.draw(quad_venn_baseline_raw)
#invisible(dev.off())
```


Raw r-square score with label


The following function is changed from the source code of the package;

The original code is in this page:

https://github.com/cran/VennDiagram/blob/master/R/draw.quad.venn.R


```{r}


```



```{r,fig.height=7,fig.width=7}
#overrideTriple=TRUE
quad_venn_baseline_raw_label <- draw.quad.venn_round(area1 = baseline_gene_psy_brain_ses_vec_corrected_raw[2]+baseline_gene_psy_brain_ses_vec_corrected_raw[5]+baseline_gene_psy_brain_ses_vec_corrected_raw[7]+baseline_gene_psy_brain_ses_vec_corrected_raw[8]+baseline_gene_psy_brain_ses_vec_corrected_raw[11]+baseline_gene_psy_brain_ses_vec_corrected_raw[13]+baseline_gene_psy_brain_ses_vec_corrected_raw[14]+baseline_gene_psy_brain_ses_vec_corrected_raw[15],
area2 = baseline_gene_psy_brain_ses_vec_corrected_raw[3]+baseline_gene_psy_brain_ses_vec_corrected_raw[5]+baseline_gene_psy_brain_ses_vec_corrected_raw[6]+baseline_gene_psy_brain_ses_vec_corrected_raw[9]+baseline_gene_psy_brain_ses_vec_corrected_raw[11]+baseline_gene_psy_brain_ses_vec_corrected_raw[12]+baseline_gene_psy_brain_ses_vec_corrected_raw[13]+baseline_gene_psy_brain_ses_vec_corrected_raw[15],
area3 = baseline_gene_psy_brain_ses_vec_corrected_raw[1]+baseline_gene_psy_brain_ses_vec_corrected_raw[6]+baseline_gene_psy_brain_ses_vec_corrected_raw[7]+baseline_gene_psy_brain_ses_vec_corrected_raw[10]+baseline_gene_psy_brain_ses_vec_corrected_raw[11]+baseline_gene_psy_brain_ses_vec_corrected_raw[12]+baseline_gene_psy_brain_ses_vec_corrected_raw[14]+baseline_gene_psy_brain_ses_vec_corrected_raw[15],
area4 = baseline_gene_psy_brain_ses_vec_corrected_raw[4]+baseline_gene_psy_brain_ses_vec_corrected_raw[8]+baseline_gene_psy_brain_ses_vec_corrected_raw[9]+baseline_gene_psy_brain_ses_vec_corrected_raw[10]+baseline_gene_psy_brain_ses_vec_corrected_raw[12]+baseline_gene_psy_brain_ses_vec_corrected_raw[13]+baseline_gene_psy_brain_ses_vec_corrected_raw[14]+baseline_gene_psy_brain_ses_vec_corrected_raw[15],
n12 = baseline_gene_psy_brain_ses_vec_corrected_raw[5]+baseline_gene_psy_brain_ses_vec_corrected_raw[11]+baseline_gene_psy_brain_ses_vec_corrected_raw[13]+baseline_gene_psy_brain_ses_vec_corrected_raw[15],
n13 = baseline_gene_psy_brain_ses_vec_corrected_raw[7]+baseline_gene_psy_brain_ses_vec_corrected_raw[11]+baseline_gene_psy_brain_ses_vec_corrected_raw[14]+baseline_gene_psy_brain_ses_vec_corrected_raw[15],
n23 = baseline_gene_psy_brain_ses_vec_corrected_raw[6]+baseline_gene_psy_brain_ses_vec_corrected_raw[11]+baseline_gene_psy_brain_ses_vec_corrected_raw[12]+baseline_gene_psy_brain_ses_vec_corrected_raw[15],
n14 = baseline_gene_psy_brain_ses_vec_corrected_raw[8]+baseline_gene_psy_brain_ses_vec_corrected_raw[13]+baseline_gene_psy_brain_ses_vec_corrected_raw[14]+baseline_gene_psy_brain_ses_vec_corrected_raw[15],
n24 = baseline_gene_psy_brain_ses_vec_corrected_raw[9]+baseline_gene_psy_brain_ses_vec_corrected_raw[12]+baseline_gene_psy_brain_ses_vec_corrected_raw[13]+baseline_gene_psy_brain_ses_vec_corrected_raw[15],
n34 = baseline_gene_psy_brain_ses_vec_corrected_raw[10]+baseline_gene_psy_brain_ses_vec_corrected_raw[12]+baseline_gene_psy_brain_ses_vec_corrected_raw[14]+baseline_gene_psy_brain_ses_vec_corrected_raw[15],
n123 =baseline_gene_psy_brain_ses_vec_corrected_raw[11]+baseline_gene_psy_brain_ses_vec_corrected_raw[15],
n124 = baseline_gene_psy_brain_ses_vec_corrected_raw[13]+baseline_gene_psy_brain_ses_vec_corrected_raw[15],
n134 = baseline_gene_psy_brain_ses_vec_corrected_raw[14]+baseline_gene_psy_brain_ses_vec_corrected_raw[15],
n234 = baseline_gene_psy_brain_ses_vec_corrected_raw[12]+baseline_gene_psy_brain_ses_vec_corrected_raw[15],
n1234 = baseline_gene_psy_brain_ses_vec_corrected_raw[15],
category = c("Neuro-\nimaging", "Mental \nHealth", "Polygenic \nScores","SD LS \nDev Adv"),
fill = c("#009E73", "#D55E00", "#CC79A7","#999999"),
lty = "dashed",
cat.col = c("#009E73", "#D55E00", "#CC79A7","#999999"),
filename = NULL,
cex = 2, ## label font size
cat.cex = 2,### caption font size
lwd = 2,
cat.fontface = "bold",
cat.dist = c(0.24, 0.25,0.13,0.13), # Modified
  cat.pos = c(-8,10,1,-13),# Modified
#print.mode="percent"
)


grid.newpage()

#grid::grid.draw(quad_venn_baseline_raw_label)
#invisible(dev.off())
```



```{r,fig.height=7,fig.width=7}

quad_venn_baseline_raw_label <- draw.quad.venn_round(
area1=baseline_gene_psy_brain_ses_vec_corrected_raw[3]+baseline_gene_psy_brain_ses_vec_corrected_raw[5]+baseline_gene_psy_brain_ses_vec_corrected_raw[6]+baseline_gene_psy_brain_ses_vec_corrected_raw[9]+baseline_gene_psy_brain_ses_vec_corrected_raw[11]+baseline_gene_psy_brain_ses_vec_corrected_raw[12]+baseline_gene_psy_brain_ses_vec_corrected_raw[13]+baseline_gene_psy_brain_ses_vec_corrected_raw[15],
area2 = baseline_gene_psy_brain_ses_vec_corrected_raw[4]+baseline_gene_psy_brain_ses_vec_corrected_raw[8]+baseline_gene_psy_brain_ses_vec_corrected_raw[9]+baseline_gene_psy_brain_ses_vec_corrected_raw[10]+baseline_gene_psy_brain_ses_vec_corrected_raw[12]+baseline_gene_psy_brain_ses_vec_corrected_raw[13]+baseline_gene_psy_brain_ses_vec_corrected_raw[14]+baseline_gene_psy_brain_ses_vec_corrected_raw[15],
area3=baseline_gene_psy_brain_ses_vec_corrected_raw[2]+baseline_gene_psy_brain_ses_vec_corrected_raw[5]+baseline_gene_psy_brain_ses_vec_corrected_raw[7]+baseline_gene_psy_brain_ses_vec_corrected_raw[8]+baseline_gene_psy_brain_ses_vec_corrected_raw[11]+baseline_gene_psy_brain_ses_vec_corrected_raw[13]+baseline_gene_psy_brain_ses_vec_corrected_raw[14]+baseline_gene_psy_brain_ses_vec_corrected_raw[15],
area4 = baseline_gene_psy_brain_ses_vec_corrected_raw[1]+baseline_gene_psy_brain_ses_vec_corrected_raw[6]+baseline_gene_psy_brain_ses_vec_corrected_raw[7]+baseline_gene_psy_brain_ses_vec_corrected_raw[10]+baseline_gene_psy_brain_ses_vec_corrected_raw[11]+baseline_gene_psy_brain_ses_vec_corrected_raw[12]+baseline_gene_psy_brain_ses_vec_corrected_raw[14]+baseline_gene_psy_brain_ses_vec_corrected_raw[15],
n12 = baseline_gene_psy_brain_ses_vec_corrected_raw[9]+baseline_gene_psy_brain_ses_vec_corrected_raw[12]+baseline_gene_psy_brain_ses_vec_corrected_raw[13]+baseline_gene_psy_brain_ses_vec_corrected_raw[15],
n13 = baseline_gene_psy_brain_ses_vec_corrected_raw[5]+baseline_gene_psy_brain_ses_vec_corrected_raw[11]+baseline_gene_psy_brain_ses_vec_corrected_raw[13]+baseline_gene_psy_brain_ses_vec_corrected_raw[15],
n14 = baseline_gene_psy_brain_ses_vec_corrected_raw[6]+baseline_gene_psy_brain_ses_vec_corrected_raw[11]+baseline_gene_psy_brain_ses_vec_corrected_raw[12]+baseline_gene_psy_brain_ses_vec_corrected_raw[15],
n23 = baseline_gene_psy_brain_ses_vec_corrected_raw[8]+baseline_gene_psy_brain_ses_vec_corrected_raw[13]+baseline_gene_psy_brain_ses_vec_corrected_raw[14]+baseline_gene_psy_brain_ses_vec_corrected_raw[15],
n24 = baseline_gene_psy_brain_ses_vec_corrected_raw[10]+baseline_gene_psy_brain_ses_vec_corrected_raw[12]+baseline_gene_psy_brain_ses_vec_corrected_raw[14]+baseline_gene_psy_brain_ses_vec_corrected_raw[15],
n34 = baseline_gene_psy_brain_ses_vec_corrected_raw[7]+baseline_gene_psy_brain_ses_vec_corrected_raw[11]+baseline_gene_psy_brain_ses_vec_corrected_raw[14]+baseline_gene_psy_brain_ses_vec_corrected_raw[15],
n123 = baseline_gene_psy_brain_ses_vec_corrected_raw[13]+baseline_gene_psy_brain_ses_vec_corrected_raw[15],
n124 = baseline_gene_psy_brain_ses_vec_corrected_raw[12]+baseline_gene_psy_brain_ses_vec_corrected_raw[15],
n134 =baseline_gene_psy_brain_ses_vec_corrected_raw[11]+baseline_gene_psy_brain_ses_vec_corrected_raw[15],
n234 = baseline_gene_psy_brain_ses_vec_corrected_raw[14]+baseline_gene_psy_brain_ses_vec_corrected_raw[15],
n1234 = baseline_gene_psy_brain_ses_vec_corrected_raw[15],
category = c("Mental \nHealth","SD LS \nDev Adv","Neuro-\nimaging",  "Polygenic \nScores"),
fill = c("#D55E00","#999999","#009E73",  "#CC79A7"),
lty = "dashed",
cat.col = c( "#D55E00","#999999","#009E73", "#CC79A7"),
filename = NULL,
cex = 2, ## label font size
cat.cex = 2,### caption font size
lwd = 2,
cat.fontface = "bold",
cat.dist = c(0.24, 0.25,0.13,0.13), # Modified
cat.pos = c(-8,5,1,-13),# Modified
                                                     #print.mode="percent"
)


grid.newpage()

#grid::grid.draw(quad_venn_baseline_raw_label)
#invisible(dev.off())

```

## followup percentage of rsquare plot

```{r,fig.height=10,fig.width=10}
overrideTriple=TRUE

quad_venn_followup_percent <- draw.quad.venn(area1 = followup_gene_psy_brain_ses_vec_corrected_percentage[2]+followup_gene_psy_brain_ses_vec_corrected_percentage[5]+followup_gene_psy_brain_ses_vec_corrected_percentage[7]+followup_gene_psy_brain_ses_vec_corrected_percentage[8]+followup_gene_psy_brain_ses_vec_corrected_percentage[11]+followup_gene_psy_brain_ses_vec_corrected_percentage[13]+followup_gene_psy_brain_ses_vec_corrected_percentage[14]+followup_gene_psy_brain_ses_vec_corrected_percentage[15],
  area2 = followup_gene_psy_brain_ses_vec_corrected_percentage[3]+followup_gene_psy_brain_ses_vec_corrected_percentage[5]+followup_gene_psy_brain_ses_vec_corrected_percentage[6]+followup_gene_psy_brain_ses_vec_corrected_percentage[9]+followup_gene_psy_brain_ses_vec_corrected_percentage[11]+followup_gene_psy_brain_ses_vec_corrected_percentage[12]+followup_gene_psy_brain_ses_vec_corrected_percentage[13]+followup_gene_psy_brain_ses_vec_corrected_percentage[15],
  area3 = followup_gene_psy_brain_ses_vec_corrected_percentage[1]+followup_gene_psy_brain_ses_vec_corrected_percentage[6]+followup_gene_psy_brain_ses_vec_corrected_percentage[7]+followup_gene_psy_brain_ses_vec_corrected_percentage[10]+followup_gene_psy_brain_ses_vec_corrected_percentage[11]+followup_gene_psy_brain_ses_vec_corrected_percentage[12]+followup_gene_psy_brain_ses_vec_corrected_percentage[14]+followup_gene_psy_brain_ses_vec_corrected_percentage[15],
  area4 =  followup_gene_psy_brain_ses_vec_corrected_percentage[4]+followup_gene_psy_brain_ses_vec_corrected_percentage[8]+followup_gene_psy_brain_ses_vec_corrected_percentage[9]+followup_gene_psy_brain_ses_vec_corrected_percentage[10]+followup_gene_psy_brain_ses_vec_corrected_percentage[12]+followup_gene_psy_brain_ses_vec_corrected_percentage[13]+followup_gene_psy_brain_ses_vec_corrected_percentage[14]+followup_gene_psy_brain_ses_vec_corrected_percentage[15],
  n12 = followup_gene_psy_brain_ses_vec_corrected_percentage[5]+followup_gene_psy_brain_ses_vec_corrected_percentage[11]+followup_gene_psy_brain_ses_vec_corrected_percentage[13]+followup_gene_psy_brain_ses_vec_corrected_percentage[15],
  n13 = followup_gene_psy_brain_ses_vec_corrected_percentage[7]+followup_gene_psy_brain_ses_vec_corrected_percentage[11]+followup_gene_psy_brain_ses_vec_corrected_percentage[14]+followup_gene_psy_brain_ses_vec_corrected_percentage[15],
  n23 = followup_gene_psy_brain_ses_vec_corrected_percentage[6]+followup_gene_psy_brain_ses_vec_corrected_percentage[11]+followup_gene_psy_brain_ses_vec_corrected_percentage[12]+followup_gene_psy_brain_ses_vec_corrected_percentage[15],
  n14 = followup_gene_psy_brain_ses_vec_corrected_percentage[8]+followup_gene_psy_brain_ses_vec_corrected_percentage[13]+followup_gene_psy_brain_ses_vec_corrected_percentage[14]+followup_gene_psy_brain_ses_vec_corrected_percentage[15],
  n24 = followup_gene_psy_brain_ses_vec_corrected_percentage[9]+followup_gene_psy_brain_ses_vec_corrected_percentage[12]+followup_gene_psy_brain_ses_vec_corrected_percentage[13]+followup_gene_psy_brain_ses_vec_corrected_percentage[15],
  n34 = followup_gene_psy_brain_ses_vec_corrected_percentage[10]+followup_gene_psy_brain_ses_vec_corrected_percentage[12]+followup_gene_psy_brain_ses_vec_corrected_percentage[14]+followup_gene_psy_brain_ses_vec_corrected_percentage[15],
  n123 = followup_gene_psy_brain_ses_vec_corrected_percentage[11]+followup_gene_psy_brain_ses_vec_corrected_percentage[15],
  n124 = followup_gene_psy_brain_ses_vec_corrected_percentage[13]+followup_gene_psy_brain_ses_vec_corrected_percentage[15],
  n134 = followup_gene_psy_brain_ses_vec_corrected_percentage[14]+followup_gene_psy_brain_ses_vec_corrected_percentage[15],
  n234 = followup_gene_psy_brain_ses_vec_corrected_percentage[12]+followup_gene_psy_brain_ses_vec_corrected_percentage[15],
  n1234 = followup_gene_psy_brain_ses_vec_corrected_percentage[15],
  category = c("Brain \nImaging", "Mental \nHealth", "Polygenic \nScores","SD LS \nDev Adv"),
  fill = c("#009E73", "#D55E00", "#CC79A7","#999999"),
  lty = "dashed",
  cat.col = c("#009E73", "#D55E00", "#CC79A7","#999999"),
  filename = NULL,
  cex = 0.001, ## label font size
  cat.cex = 2,### caption font size
  lwd = 2,
  cat.fontface = "bold",
 cat.dist = c(0.24, 0.25,0.13,0.13), # Modified
  cat.pos = c(-8,10,1,-13),# Modified
  print.mode="percent",
  euler.d=F,
  scaled=F,
  reverse = F,
  direct.area=TRUE)

grid.newpage()

#grid::grid.draw(quad_venn_followup_percent)
#invisible(dev.off())
```


```{r,fig.height=10,fig.width=10}
#overrideTriple=TRUE

quad_venn_followup_percent_label <- draw.quad.venn(area1 = followup_gene_psy_brain_ses_vec_corrected_percentage[2]+followup_gene_psy_brain_ses_vec_corrected_percentage[5]+followup_gene_psy_brain_ses_vec_corrected_percentage[7]+followup_gene_psy_brain_ses_vec_corrected_percentage[8]+followup_gene_psy_brain_ses_vec_corrected_percentage[11]+followup_gene_psy_brain_ses_vec_corrected_percentage[13]+followup_gene_psy_brain_ses_vec_corrected_percentage[14]+followup_gene_psy_brain_ses_vec_corrected_percentage[15],
  area2 = followup_gene_psy_brain_ses_vec_corrected_percentage[3]+followup_gene_psy_brain_ses_vec_corrected_percentage[5]+followup_gene_psy_brain_ses_vec_corrected_percentage[6]+followup_gene_psy_brain_ses_vec_corrected_percentage[9]+followup_gene_psy_brain_ses_vec_corrected_percentage[11]+followup_gene_psy_brain_ses_vec_corrected_percentage[12]+followup_gene_psy_brain_ses_vec_corrected_percentage[13]+followup_gene_psy_brain_ses_vec_corrected_percentage[15],
  area3 = followup_gene_psy_brain_ses_vec_corrected_percentage[1]+followup_gene_psy_brain_ses_vec_corrected_percentage[6]+followup_gene_psy_brain_ses_vec_corrected_percentage[7]+followup_gene_psy_brain_ses_vec_corrected_percentage[10]+followup_gene_psy_brain_ses_vec_corrected_percentage[11]+followup_gene_psy_brain_ses_vec_corrected_percentage[12]+followup_gene_psy_brain_ses_vec_corrected_percentage[14]+followup_gene_psy_brain_ses_vec_corrected_percentage[15],
  area4 =  followup_gene_psy_brain_ses_vec_corrected_percentage[4]+followup_gene_psy_brain_ses_vec_corrected_percentage[8]+followup_gene_psy_brain_ses_vec_corrected_percentage[9]+followup_gene_psy_brain_ses_vec_corrected_percentage[10]+followup_gene_psy_brain_ses_vec_corrected_percentage[12]+followup_gene_psy_brain_ses_vec_corrected_percentage[13]+followup_gene_psy_brain_ses_vec_corrected_percentage[14]+followup_gene_psy_brain_ses_vec_corrected_percentage[15],
  n12 = followup_gene_psy_brain_ses_vec_corrected_percentage[5]+followup_gene_psy_brain_ses_vec_corrected_percentage[11]+followup_gene_psy_brain_ses_vec_corrected_percentage[13]+followup_gene_psy_brain_ses_vec_corrected_percentage[15],
  n13 = followup_gene_psy_brain_ses_vec_corrected_percentage[7]+followup_gene_psy_brain_ses_vec_corrected_percentage[11]+followup_gene_psy_brain_ses_vec_corrected_percentage[14]+followup_gene_psy_brain_ses_vec_corrected_percentage[15],
  n23 = followup_gene_psy_brain_ses_vec_corrected_percentage[6]+followup_gene_psy_brain_ses_vec_corrected_percentage[11]+followup_gene_psy_brain_ses_vec_corrected_percentage[12]+followup_gene_psy_brain_ses_vec_corrected_percentage[15],
  n14 = followup_gene_psy_brain_ses_vec_corrected_percentage[8]+followup_gene_psy_brain_ses_vec_corrected_percentage[13]+followup_gene_psy_brain_ses_vec_corrected_percentage[14]+followup_gene_psy_brain_ses_vec_corrected_percentage[15],
  n24 = followup_gene_psy_brain_ses_vec_corrected_percentage[9]+followup_gene_psy_brain_ses_vec_corrected_percentage[12]+followup_gene_psy_brain_ses_vec_corrected_percentage[13]+followup_gene_psy_brain_ses_vec_corrected_percentage[15],
  n34 = followup_gene_psy_brain_ses_vec_corrected_percentage[10]+followup_gene_psy_brain_ses_vec_corrected_percentage[12]+followup_gene_psy_brain_ses_vec_corrected_percentage[14]+followup_gene_psy_brain_ses_vec_corrected_percentage[15],
  n123 = followup_gene_psy_brain_ses_vec_corrected_percentage[11]+followup_gene_psy_brain_ses_vec_corrected_percentage[15],
  n124 = followup_gene_psy_brain_ses_vec_corrected_percentage[13]+followup_gene_psy_brain_ses_vec_corrected_percentage[15],
  n134 = followup_gene_psy_brain_ses_vec_corrected_percentage[14]+followup_gene_psy_brain_ses_vec_corrected_percentage[15],
  n234 = followup_gene_psy_brain_ses_vec_corrected_percentage[12]+followup_gene_psy_brain_ses_vec_corrected_percentage[15],
  n1234 = followup_gene_psy_brain_ses_vec_corrected_percentage[15],
  category = c("Brain \nImaging", "Mental \nHealth", "Polygenic \nScores","SD LS \nDev Adv"),
  fill = c("#009E73", "#D55E00", "#CC79A7","#999999"),
  lty = "dashed",
  cat.col = c("#009E73", "#D55E00", "#CC79A7","#999999"),
    filename = NULL,
  cex = 2, ## label font size
  cat.cex = 2.5,### caption font size
  lwd = 2,
  cat.fontface = "bold",
  cat.dist = c(0.24, 0.25,0.13,0.13), # Modified
  cat.pos = c(-8,10,1,-13),# Modified
  print.mode="percent"
  )


grid.newpage()

#grid::grid.draw(quad_venn_followup_percent_label)
#invisible(dev.off())
```

The raw R-squared plot

```{r,fig.height=10,fig.width=10}
overrideTriple=TRUE

quad_venn_followup_raw <- draw.quad.venn(area1 = followup_gene_psy_brain_ses_vec_corrected_raw[2]+followup_gene_psy_brain_ses_vec_corrected_raw[5]+followup_gene_psy_brain_ses_vec_corrected_raw[7]+followup_gene_psy_brain_ses_vec_corrected_raw[8]+followup_gene_psy_brain_ses_vec_corrected_raw[11]+followup_gene_psy_brain_ses_vec_corrected_raw[13]+followup_gene_psy_brain_ses_vec_corrected_raw[14]+followup_gene_psy_brain_ses_vec_corrected_raw[15],
  area2 = followup_gene_psy_brain_ses_vec_corrected_raw[3]+followup_gene_psy_brain_ses_vec_corrected_raw[5]+followup_gene_psy_brain_ses_vec_corrected_raw[6]+followup_gene_psy_brain_ses_vec_corrected_raw[9]+baseline_gene_psy_brain_ses_vec_corrected_raw[11]+followup_gene_psy_brain_ses_vec_corrected_raw[12]+followup_gene_psy_brain_ses_vec_corrected_raw[13]+followup_gene_psy_brain_ses_vec_corrected_raw[15],
  area3 = followup_gene_psy_brain_ses_vec_corrected_raw[1]+followup_gene_psy_brain_ses_vec_corrected_raw[6]+followup_gene_psy_brain_ses_vec_corrected_raw[7]+followup_gene_psy_brain_ses_vec_corrected_raw[10]+followup_gene_psy_brain_ses_vec_corrected_raw[11]+followup_gene_psy_brain_ses_vec_corrected_raw[12]+followup_gene_psy_brain_ses_vec_corrected_raw[14]+followup_gene_psy_brain_ses_vec_corrected_raw[15],
  area4 =  followup_gene_psy_brain_ses_vec_corrected_raw[4]+followup_gene_psy_brain_ses_vec_corrected_raw[8]+followup_gene_psy_brain_ses_vec_corrected_raw[9]+followup_gene_psy_brain_ses_vec_corrected_raw[10]+baseline_gene_psy_brain_ses_vec_corrected_raw[12]+followup_gene_psy_brain_ses_vec_corrected_raw[13]+baseline_gene_psy_brain_ses_vec_corrected_raw[14]+followup_gene_psy_brain_ses_vec_corrected_raw[15],
  n12 = followup_gene_psy_brain_ses_vec_corrected_raw[5]+followup_gene_psy_brain_ses_vec_corrected_raw[11]+followup_gene_psy_brain_ses_vec_corrected_raw[13]+followup_gene_psy_brain_ses_vec_corrected_raw[15],
  n13 = followup_gene_psy_brain_ses_vec_corrected_raw[7]+followup_gene_psy_brain_ses_vec_corrected_raw[11]+followup_gene_psy_brain_ses_vec_corrected_raw[14]+followup_gene_psy_brain_ses_vec_corrected_raw[15],
  n23 = followup_gene_psy_brain_ses_vec_corrected_raw[6]+followup_gene_psy_brain_ses_vec_corrected_raw[11]+followup_gene_psy_brain_ses_vec_corrected_raw[12]+followup_gene_psy_brain_ses_vec_corrected_raw[15],
  n14 = followup_gene_psy_brain_ses_vec_corrected_raw[8]+followup_gene_psy_brain_ses_vec_corrected_raw[13]+followup_gene_psy_brain_ses_vec_corrected_raw[14]+followup_gene_psy_brain_ses_vec_corrected_raw[15],
  n24 = followup_gene_psy_brain_ses_vec_corrected_raw[9]+followup_gene_psy_brain_ses_vec_corrected_raw[12]+followup_gene_psy_brain_ses_vec_corrected_raw[13]+followup_gene_psy_brain_ses_vec_corrected_raw[15],
  n34 = followup_gene_psy_brain_ses_vec_corrected_raw[10]+followup_gene_psy_brain_ses_vec_corrected_raw[12]+followup_gene_psy_brain_ses_vec_corrected_raw[14]+followup_gene_psy_brain_ses_vec_corrected_raw[15],
  n123 = followup_gene_psy_brain_ses_vec_corrected_raw[11]+followup_gene_psy_brain_ses_vec_corrected_raw[15],
  n124 = followup_gene_psy_brain_ses_vec_corrected_raw[13]+followup_gene_psy_brain_ses_vec_corrected_raw[15],
  n134 = followup_gene_psy_brain_ses_vec_corrected_raw[14]+followup_gene_psy_brain_ses_vec_corrected_raw[15],
  n234 = followup_gene_psy_brain_ses_vec_corrected_raw[12]+followup_gene_psy_brain_ses_vec_corrected_raw[15],
  n1234 = followup_gene_psy_brain_ses_vec_corrected_raw[15],
  category = c("Brain \nImaging", "Mental \nHealth", "Polygenic \nScores","SD LS \nDev Adv"),
  fill = c("#009E73", "#D55E00", "#CC79A7","#999999"),
  lty = "dashed",
  cat.col = c("#009E73", "#D55E00", "#CC79A7","#999999"),
  filename = NULL,
  cex = 0.001, ## label font size
  cat.cex = 2,### caption font size
  lwd = 2,
  cat.fontface = "bold",
cat.dist = c(0.24, 0.25,0.13,0.13), # Modified
  cat.pos = c(-8,10,1,-13),# Modified
  print.mode="percent",
  euler.d=F,
  scaled=F,
  reverse = F,
  direct.area=TRUE)

grid.newpage()

#grid::grid.draw(quad_venn_followup_raw)
#invisible(dev.off())
```


```{r,fig.height=7,fig.width=7}
#overrideTriple=TRUE

quad_venn_followup_raw_label <- draw.quad.venn_round(area1 = followup_gene_psy_brain_ses_vec_corrected_raw[2]+followup_gene_psy_brain_ses_vec_corrected_raw[5]+followup_gene_psy_brain_ses_vec_corrected_raw[7]+followup_gene_psy_brain_ses_vec_corrected_raw[8]+followup_gene_psy_brain_ses_vec_corrected_raw[11]+followup_gene_psy_brain_ses_vec_corrected_raw[13]+followup_gene_psy_brain_ses_vec_corrected_raw[14]+followup_gene_psy_brain_ses_vec_corrected_raw[15],
  area2 = followup_gene_psy_brain_ses_vec_corrected_raw[3]+followup_gene_psy_brain_ses_vec_corrected_raw[5]+followup_gene_psy_brain_ses_vec_corrected_raw[6]+followup_gene_psy_brain_ses_vec_corrected_raw[9]+baseline_gene_psy_brain_ses_vec_corrected_raw[11]+followup_gene_psy_brain_ses_vec_corrected_raw[12]+followup_gene_psy_brain_ses_vec_corrected_raw[13]+followup_gene_psy_brain_ses_vec_corrected_raw[15],
  area3 = followup_gene_psy_brain_ses_vec_corrected_raw[1]+followup_gene_psy_brain_ses_vec_corrected_raw[6]+followup_gene_psy_brain_ses_vec_corrected_raw[7]+followup_gene_psy_brain_ses_vec_corrected_raw[10]+followup_gene_psy_brain_ses_vec_corrected_raw[11]+followup_gene_psy_brain_ses_vec_corrected_raw[12]+followup_gene_psy_brain_ses_vec_corrected_raw[14]+followup_gene_psy_brain_ses_vec_corrected_raw[15],
  area4 =  followup_gene_psy_brain_ses_vec_corrected_raw[4]+followup_gene_psy_brain_ses_vec_corrected_raw[8]+followup_gene_psy_brain_ses_vec_corrected_raw[9]+followup_gene_psy_brain_ses_vec_corrected_raw[10]+baseline_gene_psy_brain_ses_vec_corrected_raw[12]+followup_gene_psy_brain_ses_vec_corrected_raw[13]+baseline_gene_psy_brain_ses_vec_corrected_raw[14]+followup_gene_psy_brain_ses_vec_corrected_raw[15],
  n12 = followup_gene_psy_brain_ses_vec_corrected_raw[5]+followup_gene_psy_brain_ses_vec_corrected_raw[11]+followup_gene_psy_brain_ses_vec_corrected_raw[13]+followup_gene_psy_brain_ses_vec_corrected_raw[15],
  n13 = followup_gene_psy_brain_ses_vec_corrected_raw[7]+followup_gene_psy_brain_ses_vec_corrected_raw[11]+followup_gene_psy_brain_ses_vec_corrected_raw[14]+followup_gene_psy_brain_ses_vec_corrected_raw[15],
  n23 = followup_gene_psy_brain_ses_vec_corrected_raw[6]+followup_gene_psy_brain_ses_vec_corrected_raw[11]+followup_gene_psy_brain_ses_vec_corrected_raw[12]+followup_gene_psy_brain_ses_vec_corrected_raw[15],
  n14 = followup_gene_psy_brain_ses_vec_corrected_raw[8]+followup_gene_psy_brain_ses_vec_corrected_raw[13]+followup_gene_psy_brain_ses_vec_corrected_raw[14]+followup_gene_psy_brain_ses_vec_corrected_raw[15],
  n24 = followup_gene_psy_brain_ses_vec_corrected_raw[9]+followup_gene_psy_brain_ses_vec_corrected_raw[12]+followup_gene_psy_brain_ses_vec_corrected_raw[13]+followup_gene_psy_brain_ses_vec_corrected_raw[15],
  n34 = followup_gene_psy_brain_ses_vec_corrected_raw[10]+followup_gene_psy_brain_ses_vec_corrected_raw[12]+followup_gene_psy_brain_ses_vec_corrected_raw[14]+followup_gene_psy_brain_ses_vec_corrected_raw[15],
  n123 = followup_gene_psy_brain_ses_vec_corrected_raw[11]+followup_gene_psy_brain_ses_vec_corrected_raw[15],
  n124 = followup_gene_psy_brain_ses_vec_corrected_raw[13]+followup_gene_psy_brain_ses_vec_corrected_raw[15],
  n134 = followup_gene_psy_brain_ses_vec_corrected_raw[14]+followup_gene_psy_brain_ses_vec_corrected_raw[15],
  n234 = followup_gene_psy_brain_ses_vec_corrected_raw[12]+followup_gene_psy_brain_ses_vec_corrected_raw[15],
  n1234 = followup_gene_psy_brain_ses_vec_corrected_raw[15],
  category = c("Neuro-\nimaging", "Mental \nHealth", "Polygenic \nScores","SD LS \nDev Adv"),
  fill = c("#009E73", "#D55E00", "#CC79A7","#999999"),
  lty = "dashed",
  cat.col = c("#009E73", "#D55E00", "#CC79A7","#999999"),
    filename = NULL,
  cex = 2, ## label font size
  cat.cex = 2,### caption font size
  lwd = 2,
  cat.fontface = "bold",
   cat.dist = c(0.24, 0.25,0.13,0.13), # Modified
  cat.pos = c(-8,10,1,-13),# Modified
  #print.mode="percent"
  )


grid.newpage()

#grid::grid.draw(quad_venn_followup_raw_label)
#invisible(dev.off())
```



```{r,fig.height=7,fig.width=7}
#overrideTriple=TRUE

quad_venn_followup_raw_label <- draw.quad.venn_round(
area3 = followup_gene_psy_brain_ses_vec_corrected_raw[2]+followup_gene_psy_brain_ses_vec_corrected_raw[5]+followup_gene_psy_brain_ses_vec_corrected_raw[7]+followup_gene_psy_brain_ses_vec_corrected_raw[8]+followup_gene_psy_brain_ses_vec_corrected_raw[11]+followup_gene_psy_brain_ses_vec_corrected_raw[13]+followup_gene_psy_brain_ses_vec_corrected_raw[14]+followup_gene_psy_brain_ses_vec_corrected_raw[15],
area1 = followup_gene_psy_brain_ses_vec_corrected_raw[3]+followup_gene_psy_brain_ses_vec_corrected_raw[5]+followup_gene_psy_brain_ses_vec_corrected_raw[6]+followup_gene_psy_brain_ses_vec_corrected_raw[9]+baseline_gene_psy_brain_ses_vec_corrected_raw[11]+followup_gene_psy_brain_ses_vec_corrected_raw[12]+followup_gene_psy_brain_ses_vec_corrected_raw[13]+followup_gene_psy_brain_ses_vec_corrected_raw[15],
area4 = followup_gene_psy_brain_ses_vec_corrected_raw[1]+followup_gene_psy_brain_ses_vec_corrected_raw[6]+followup_gene_psy_brain_ses_vec_corrected_raw[7]+followup_gene_psy_brain_ses_vec_corrected_raw[10]+followup_gene_psy_brain_ses_vec_corrected_raw[11]+followup_gene_psy_brain_ses_vec_corrected_raw[12]+followup_gene_psy_brain_ses_vec_corrected_raw[14]+followup_gene_psy_brain_ses_vec_corrected_raw[15],
area2 =  followup_gene_psy_brain_ses_vec_corrected_raw[4]+followup_gene_psy_brain_ses_vec_corrected_raw[8]+followup_gene_psy_brain_ses_vec_corrected_raw[9]+followup_gene_psy_brain_ses_vec_corrected_raw[10]+baseline_gene_psy_brain_ses_vec_corrected_raw[12]+followup_gene_psy_brain_ses_vec_corrected_raw[13]+baseline_gene_psy_brain_ses_vec_corrected_raw[14]+followup_gene_psy_brain_ses_vec_corrected_raw[15],
n13 = followup_gene_psy_brain_ses_vec_corrected_raw[5]+followup_gene_psy_brain_ses_vec_corrected_raw[11]+followup_gene_psy_brain_ses_vec_corrected_raw[13]+followup_gene_psy_brain_ses_vec_corrected_raw[15],
n34 = followup_gene_psy_brain_ses_vec_corrected_raw[7]+followup_gene_psy_brain_ses_vec_corrected_raw[11]+followup_gene_psy_brain_ses_vec_corrected_raw[14]+followup_gene_psy_brain_ses_vec_corrected_raw[15],
n14 = followup_gene_psy_brain_ses_vec_corrected_raw[6]+followup_gene_psy_brain_ses_vec_corrected_raw[11]+followup_gene_psy_brain_ses_vec_corrected_raw[12]+followup_gene_psy_brain_ses_vec_corrected_raw[15],
n23 = followup_gene_psy_brain_ses_vec_corrected_raw[8]+followup_gene_psy_brain_ses_vec_corrected_raw[13]+followup_gene_psy_brain_ses_vec_corrected_raw[14]+followup_gene_psy_brain_ses_vec_corrected_raw[15],
n12 = followup_gene_psy_brain_ses_vec_corrected_raw[9]+followup_gene_psy_brain_ses_vec_corrected_raw[12]+followup_gene_psy_brain_ses_vec_corrected_raw[13]+followup_gene_psy_brain_ses_vec_corrected_raw[15],
n24 = followup_gene_psy_brain_ses_vec_corrected_raw[10]+followup_gene_psy_brain_ses_vec_corrected_raw[12]+followup_gene_psy_brain_ses_vec_corrected_raw[14]+followup_gene_psy_brain_ses_vec_corrected_raw[15],
n134 = followup_gene_psy_brain_ses_vec_corrected_raw[11]+followup_gene_psy_brain_ses_vec_corrected_raw[15],
n123 = followup_gene_psy_brain_ses_vec_corrected_raw[13]+followup_gene_psy_brain_ses_vec_corrected_raw[15],
n234 = followup_gene_psy_brain_ses_vec_corrected_raw[14]+followup_gene_psy_brain_ses_vec_corrected_raw[15],
n124 = followup_gene_psy_brain_ses_vec_corrected_raw[12]+followup_gene_psy_brain_ses_vec_corrected_raw[15],
n1234 = followup_gene_psy_brain_ses_vec_corrected_raw[15],
 category = c("Mental \nHealth","SD LS \nDev Adv","Neuro-\nimaging",  "Polygenic \nScores"),
fill = c("#D55E00","#999999","#009E73",  "#CC79A7"),
lty = "dashed",
cat.col = c( "#D55E00","#999999","#009E73", "#CC79A7"),
filename = NULL,
cex = 2, ## label font size
cat.cex = 2,### caption font size
lwd = 2,
cat.fontface = "bold",
cat.dist = c(0.24, 0.25,0.13,0.13), # Modified
cat.pos = c(-8,5,1,-13),# Modified
                                                     #print.mode="percent"
)

grid.newpage()

#grid::grid.draw(quad_venn_followup_raw_label)
#invisible(dev.off())
```


# draw the label of the venn diagrams

Just draw the title of the venn diagram. Only the equation part is extracted.

```{r,fig.width=10}

ggplot()+
  labs(title =  "<span style='font-size:15pt'>Cognitive Abilities ~ 
   <span style='color:#D55E00;'>Mental Health</span> +
   <span style='color:#009E73;'>Neuroimaging</span> +
   <span style='color:#CC79A7;'>Polygenic Scores</span> +
   <span style='color:#999999;'>SD LS Dev Adv</span> 
   </span>",
    x = NULL, y = NULL
  )+
theme(legend.position = "none",
      plot.title = element_markdown(lineheight = 1,size = 15))

```

```{r,fig.width=10}

ggplot()+
  labs(title =  "<span style='font-size:15pt'>Cognitive Abilities ~ 
    <span style='color:#D55E00;'>Mental Health</span> +
   <span style='color:#009E73;'>Neuroimaging</span>
    </span>",
    x = NULL, y = NULL
  )+
theme(legend.position = "none",
      plot.title = element_markdown(lineheight = 1,size = 15))

```


```{r,fig.width=10}

ggplot()+
  labs(title =  "<span style='font-size:15pt'>Cognitive Abilities ~ 
   <span style='color:#D55E00;'>Mental Health</span> +
   <span style='color:#999999;'>SD LS Dev Adv</span>
    </span>",
    x = NULL, y = NULL
  )+
theme(legend.position = "none",
      plot.title = element_markdown(lineheight = 1,size = 15))

```


```{r,fig.width=10}

ggplot()+
  labs(title =  "<span style='font-size:15pt'>Cognitive Abilities ~ 
    <span style='color:#D55E00;'>Mental Health</span> +
   <span style='color:#CC79A7;'>Polygenic Scores</span> 
    </span>",
    x = NULL, y = NULL
  )+
theme(legend.position = "none",
      plot.title = element_markdown(lineheight = 1,size = 15))

```


